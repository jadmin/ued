mbox.ui=mbox.ui||{};baidu.object.extend(baidu.ui.dialog.Dialog.prototype,{setup:function(c){var b=this,a=b.renderMain();c=baidu.g(c);a.appendChild(baidu.g(c));b.setupDOM(c);b.update(b);baidu.dom.setStyles(b.getMain(),{position:"absolute",zIndex:this.zIndex,marginLeft:"-100000px"});b.dispatchEvent("onload")},setupDOM:function(c){var a=this;c.id=a.getId();baidu.dom.addClass(c,a.getClass());var b=baidu.dom.children(a.getBody());b[0].id=a.getId("title");baidu.dom.addClass(b[0],a.getClass("title"));b[1].id=a.getId("content");baidu.dom.addClass(b[1],a.getClass("content"));b[2].id=a.getId("footer");baidu.dom.addClass(b[2],a.getClass("footer"))}});baidu.object.extend(baidu.ui.progressBar.ProgressBar.prototype,{setup:function(c){var b=this,a=b.renderMain(c);if(!a){return}b.setupDOM()},setupDOM:function(){var b=this,a=b.getMain().getElementsByTagName("div");baidu.dom.setAttrs(a[0],{id:b.getId(),"class":b.getClass()});baidu.dom.setAttrs(a[1],{id:b.getId("bar"),"class":b.getClass("bar")});b.update();b.dispatchEvent("setup")}});baidu.ui.slider.Slider.prototype.tplProgressContainer="<div id='#{progressbarId}' class='#{progressbarClass}' style='position:absolute; left:0px; top:0px;'></div>";baidu.ui.slider.Slider.register(function(a){a.addEventListener("onload",function(){var b=this;baidu.dom.insertHTML(b.getBody(),"afterBegin",baidu.string.format(b.tplProgressContainer,{progressbarId:b.getId("progressBar"),progressbarClass:b.getClass("progressbar")}));b.loaderProgressBar=baidu.ui.create(baidu.ui.progressBar.ProgressBar,{layout:b.layout,value:10,skin:b.skin?b.skin+"-loaderProgressbar":null,onupdate:function(){b.range=[0,b.loaderProgressBar.getValue()];b.update()}});b.loaderProgressBar.render(b.getId("progressBar"))})});baidu.ui.slider.Slider.register(function(a){if(a.enableLoader){a.addEventListener("setup",function(){var b=baidu.dom.children(a.getBody())[0];baidu.dom.setAttrs(b,{id:a.getId("loader-progressbar"),"class":a.getClass("loaderProgressbarMain"),style:"position:absolute; left:0px; top:0px;"});a.loaderProgressBar=baidu.ui.create(baidu.ui.progressBar.ProgressBar,{layout:a.layout,skin:a.skin?a.skin+"-loaderProgressbar":null,onupdate:function(){a.range=[0,a.loaderProgressBar.getValue()];a.update()}});a.loaderProgressBar.setup(a.getId("loader-progressbar"));a.addEventListener("dispose",function(){a.loaderProgressBar.dispose()})})}});baidu.ui.slider.Slider.register(function(a){a.addEventListener("setup",function(){var c=baidu.dom.children(a.getBody()),b=c[c.length-2];baidu.dom.setAttrs(b,{id:a.getId("progressbar"),"class":a.getClass("progressbar"),style:"position:absolute"});a.progressBar=baidu.ui.create(baidu.ui.progressBar.ProgressBar,{layout:a.layout,skin:a.skin?a.skin+"-followProgressbar":null});a.progressBar.setup(a.getId("progressbar"));a._adjustProgressbar();a.addEventListener("dispose",function(){a.progressBar.dispose()})});a.addEventListeners("slide, update",function(){if(a.progressBar){a._adjustProgressbar()}})});baidu.ui.slider.Slider.extend({_adjustProgressbar:function(){var d=this,c=d.layout,a=d.axis[c],b=parseInt(baidu.dom.getStyle(d.getThumb(),a.thumbPos),10);d.progressBar.getBar().style[d.progressBar.axis[c].size]=(isNaN(b)?0:b)+d[a._getThumbSize]()/2+"px"}});baidu.object.extend(baidu.ui.slider.Slider.prototype,{setup:function(d){var c=this,a=c.renderMain(d),b;if(!a){return}c.setupDOM();c._createThumb();c.update();c.dispatchEvent("setup")},setupDOM:function(){var d=this,b=d.getMain().getElementsByTagName("div"),a=b[0],c=b[b.length-1],e=baidu.fn.bind("_mouseHandler",d),f=baidu.fn.bind("_mouseDown",d);baidu.dom.setAttrs(a,{id:d.getId(),"class":d.getClass()});baidu.dom.setAttrs(c,{id:d.getId("thumb"),"class":d.getClass("thumb"),style:"position:absolute"});baidu.event.on(a,"mousedown",f);c.onmouseover=e;c.onmouseout=e;c.onmousedown=e;c.onmouseup=e;d.addEventListener("dispose",function(){baidu.event.un(a,"mousedown",f)})}});mbox.ui.dialog=function(f,d,e,c,a){var b=function(){this.init()};b.prototype={init:function(){this.popup=baidu.ui.dialog.create({top:e,width:d,modal:true,draggable:c||false,resizable:a||false});this.popup.setup(f);this.dialogDom=this.popup.getMain();this.closeBtn=baidu.dom.query("#"+this.dialogDom.id+" .popclose")[0];this.submitBtn=baidu.dom.query("#"+this.dialogDom.id+" .submitbtn")[0];this.textarea_max=baidu.dom.query("#"+this.dialogDom.id+" textarea")[0];this.recomform=baidu.dom.query("#"+this.dialogDom.id+" .recomform")[0];this.recomok=baidu.dom.query("#"+this.dialogDom.id+" .recomok")[0];this.recomlimit=baidu.dom.query("#"+this.dialogDom.id+" .recomlimit")[0];this.recomtit=baidu.dom.query("#"+this.dialogDom.id+" #recom_tit")[0];this.searchpopcon=baidu.dom.query("#"+this.dialogDom.id+" #searchpopcon")[0];this.bind();if(this.textarea_max){this.orgtext=this.textarea_max.value;orgtext=this.textarea_max.value}},show:function(k,j){if(this.orgtext){this.textarea_max.value=this.orgtext}if(this.recomform){this.recomform.style.display="block";this.recomok.style.display="none";this.recomlimit.style.display="none";var g=mbox.data.getFromSongCache(k);this.songId=k;var i=baidu.dom.query(".textlimit")[0];var h=baidu.dom.query(".textlimit .typed")[0];baidu.dom.removeClass(i,"red");h.innerHTML="0";this.recomtit.innerHTML=g.songName}this.popup.open();if(j){j(this.popup)}},submit:function(g){if(M3.txtLimit(mbox.ui.dialog.recompop.textarea_max.value.length,50,mbox.ui.dialog.recompop.textMax)){if(this.orgtext!=g){mbox.logic.listCtrl.offerto(this.songId,g,this,this.recomchangeUI)}else{mbox.logic.listCtrl.offerto(this.songId,"",this,this.recomchangeUI)}}},bind:function(){if(this.closeBtn){baidu.event.on(this.closeBtn,"click",baidu.fn.bind(function(){this.close()},this))}if(this.submitBtn){baidu.event.on(this.submitBtn,"click",baidu.fn.bind(function(){this.submit(this.textarea_max.value)},this))}if(this.textarea_max){baidu.event.on(this.textarea_max,"focus",baidu.fn.bind(function(){M3.txtonfocus(this.orgtext,this.textarea_max,"focus");baidu.dom.addClass(this.textarea_max,"black")},this));baidu.event.on(this.textarea_max,"blur",baidu.fn.bind(function(){M3.txtonfocus(this.orgtext,this.textarea_max,"blur");baidu.dom.removeClass(this.textarea_max,"black")},this));baidu.event.on(this.textarea_max,"change",function(){M3.txtLimit(mbox.ui.dialog.recompop.textarea_max.value.length,50,mbox.ui.dialog.recompop.textMax)});baidu.event.on(this.textarea_max,"keyup",function(){M3.txtLimit(mbox.ui.dialog.recompop.textarea_max.value.length,50,mbox.ui.dialog.recompop.textMax)})}},textMax:function(k){var i="在此填写推荐语";var j=baidu.dom.query(".typed")[0];var g=baidu.dom.query(".maxtype")[0];var h=this.dialogDom;j.innerHTML=mbox.ui.dialog.recompop.textarea_max.value.length;if(!k){g.parentNode.className="textlimit red";j.innerHTML='<span class="f12">字符超出限制</span> '+mbox.ui.dialog.recompop.textarea_max.value.length}else{g.parentNode.className="textlimit"}return k},recomchangeUI:function(j,h){var i=baidu.dom.query(".typed")[0];var g=baidu.dom.query(".maxtype")[0];switch(h){case mbox.CODEMAP.SUCCESS:j.recomform.style.display="none";j.recomok.style.display="block";setTimeout(function(){j.popup.close(j)},500);break;case mbox.CODEMAP.FORBIDDEN:g.parentNode.className="textlimit red";i.innerHTML='<span class="f12">您的输入含不适当内容，请重新输入。</span> '+mbox.ui.dialog.recompop.textarea_max.value.length;break;case mbox.CODEMAP.RECOMMLIMIT:j.recomform.style.display="none";j.recomok.style.display="none";j.recomlimit.style.display="block";setTimeout(function(){j.popup.close(j)},2500);break;default:j.recomform.style.display="none";j.recomok.style.display="block";setTimeout(function(){j.popup.close(j)},500)}},close:function(g){if(this.searchpopcon){baidu.dom.query(".noresult")[0].innerHTML="";baidu.dom.query(".noresult")[0].display="none";SearchList.update([])}g?g.popup.close():this.popup.close()}};return new b};mbox.ui.dialog.recompop=mbox.ui.dialog("recoTip",340);mbox.ui.dialog.listenbreak=mbox.ui.dialog("listenbreak",500);mbox.ui.dialog.abroad=mbox.ui.dialog("abroad",458);mbox.ui.dialog.songlist=mbox.ui.dialog("songlistpop",332);mbox.ui.dialog.playfailure=mbox.ui.dialog("playfailure",350);mbox.ui.dialog.flashfailure=mbox.ui.dialog("flashfailure",350);if(Math.random()-0.5>0){baidu.g("break_tip1").style.display="block"}else{baidu.g("break_tip2").style.display="block"}(function(){M3.dispatch(mbox.ACTION.LISTENBREAK,function(){M3.dispatch(mbox.ACTION.EXPANDMOD,[true]);setTimeout(function(){mbox.ui.dialog.listenbreak.show()},100)});M3.dispatch(mbox.ACTION.ABROAD,function(){M3.dispatch(mbox.ACTION.EXPANDMOD,[true]);setTimeout(function(){mbox.ui.dialog.abroad.show()},100)});M3.dispatch(mbox.ACTION.CLOSELISTENBREAK,function(){mbox.ui.dialog.listenbreak.close()});M3.dispatch(mbox.ACTION.CLOSEABROAD,function(){mbox.ui.dialog.abroad.close()});M3.dispatch(mbox.ACTION.MEDIAERROR,function(a){M3.dispatch(mbox.ACTION.EXPANDMOD,[true]);if(listCtrl.player.curEngine=="wmp"){setTimeout(function(){mbox.ui.dialog.playfailure.show()},100)}else{if(listCtrl.player.curEngine=="fmp"||listCtrl.player.curEngine=="aac"){setTimeout(function(){mbox.ui.dialog.flashfailure.show()},100)}}});M3.dispatch(mbox.ACTION.ERR_PLAYERR,function(a){if(listCtrl.player.curEngine=="wmp"&&!mbox.ui.dialog.playfailure.showed){M3.dispatch(mbox.ACTION.EXPANDMOD,[true]);setTimeout(function(){mbox.ui.dialog.playfailure.show()},100);mbox.ui.dialog.playfailure.showed=true}})})();mbox.namespace("mbox.ui");mbox.ui.Panel=(function(g,c){var m=T.dom.query,e=T.fn.bind,b=T.event.on,h=T.dom.addClass,a=T.dom.removeClass,d=T.dom.setAttr,f=T.object.each;var l=mbox.localStorage.getVolume()||50;var o=document.title;var j="00:00";var k="00:00";var n=380;var i=function(p){var q={playbtn:" .mb-playbtn .play a",prevbtn:" .mb-playbtn .prev a",nextbtn:" .mb-playbtn .next a",randombtn:" .mb-modbtn .random a",singlebtn:" .mb-modbtn .sgelroll a",listbtn:" .mb-modbtn .listroll a",titsinger:" .mb-tit",titwarper:" .mb-tit .titwarper",songtit:" .mb-tit .titcon .stit",singer:" .mb-tit .titcon .singer",titcon:" .mb-tit .titcon",plSlider:" .mb-playslider .playslider",currTime:" .mb-time .currTime",totlTime:" .mb-time .totlTime",mutebtn:" .mb-playbtn  .mutebtn a",loadingimg:" .loadingimg",volumeSlider:" .mb-playbtn .volumeId",favorBtn:" .mb-tit .favor a",recommBtn:" .mb-tit .recomm a"};this.wraper=p.wraper;this.playbtn=m("#"+this.wraper+q.playbtn)[0];this.prevbtn=m("#"+this.wraper+q.prevbtn)[0];this.nextbtn=m("#"+this.wraper+q.nextbtn)[0];this.randombtn=m("#"+this.wraper+q.randombtn)[0];this.singlebtn=m("#"+this.wraper+q.singlebtn)[0];this.listbtn=m("#"+this.wraper+q.listbtn)[0];this.songtit=m("#"+this.wraper+q.songtit)[0];this.singer=m("#"+this.wraper+q.singer)[0];this.titsinger=m("#"+this.wraper+q.titsinger)[0];this.titwarper=m("#"+this.wraper+q.titwarper)[0];this.titcon=m("#"+this.wraper+q.titcon)[0];this.favor=m("#"+this.wraper+q.favorBtn)[0];this.recomm=m("#"+this.wraper+q.recommBtn)[0];this.mutebtn=m("#"+this.wraper+q.mutebtn)[0];this.vSlider=m("#"+this.wraper+q.volumeSlider)[0];this.plSlider=m("#"+this.wraper+q.plSlider)[0];this.currTime=m("#"+this.wraper+q.currTime)[0];this.totlTime=m("#"+this.wraper+q.totlTime)[0];this.loadingimg=m("#"+this.wraper+q.loadingimg)[0];this.init(p)};i.prototype={init:function(p){this.subEvent();this.bindEvent();this.VolumeSlider(p.base.volume);this.PlaySlider();this.reset()},subEvent:function(){M3.dispatch(mbox.ACTION.PLAYSTATECHANGE,e(function(p){this.play(p);if(p){setTimeout(e(function(){this.SongNMSinger.titScroll&&(this.SongNMSinger.titScroll.isplaying=true)},this),300)}else{!!this.SongNMSinger.titScroll&&(this.SongNMSinger.titScroll.isplaying=false,this.SongNMSinger.titScroll.reset_positon())}},this));M3.dispatch(mbox.ACTION.RESET,e(function(){this.reset()},this));M3.dispatch(mbox.ACTION.MUTECHANGE,e(function(p){this.Mutebtn.setMute(p,this)},this));M3.dispatch(mbox.ACTION.UPDATELOADED,e(function(q){this.playSlider.loaderProgressBar.update({value:q})},this));M3.dispatch(mbox.ACTION.UPDATEPLAYED,e(function(q){this.playSlider.setCurrPosition(q)},this));M3.dispatch(mbox.ACTION.UPDATEPLAYED,e(function(p){this.SongTime.setCurrTime(p.curtime,this)},this));M3.dispatch(mbox.ACTION.TOTALTIME,e(function(p){this.SongTime.setTotleTime(p,this)},this));M3.dispatch(mbox.ACTION.PLAYMODECHANGE,e(function(p){this.PlayMode.set(p,this)},this));M3.dispatch(mbox.ACTION.SHOWLOADING,e(function(p){this.LoadingState.show(p,this)},this));M3.dispatch(mbox.ACTION.LOADTITLE,e(function(p){this.winTitle.init(p);this.SongNMSinger.init(p,this)},this));M3.dispatch(mbox.ACTION.TITLE,e(function(p){this.setTitle(p)},this));M3.dispatch(mbox.ACTION.FAVOR,e(function(p){this.favorBtn.set(p,this)},this))},bindEvent:function(){b(this.playbtn,"click",function(){M3.dispatch(mbox.ACTION.UI_PLAYCHANGE,[])});b(this.prevbtn,"click",function(){M3.dispatch(mbox.ACTION.UI_PREV,[])});b(this.nextbtn,"click",function(){M3.dispatch(mbox.ACTION.UI_NEXT,[])});b(this.randombtn,"click",function(){M3.dispatch(mbox.ACTION.UI_MODECHANGE,[2])});b(this.singlebtn,"click",function(){M3.dispatch(mbox.ACTION.UI_MODECHANGE,[1])});b(this.listbtn,"click",function(){M3.dispatch(mbox.ACTION.UI_MODECHANGE,[3])});b(this.mutebtn,"click",function(){M3.dispatch(mbox.ACTION.UI_SETMUTE,[])});b(this.favor,"click",function(){M3.dispatch(mbox.ACTION.UI_FAVOR,[])});b(this.recomm,"click",function(){M3.dispatch(mbox.ACTION.UI_RECOM,[])})},Ctrl:{init:e(function(q,p){q.toggleBtn(q.playbtn,"on",p)},this),reset:function(p){p.toggleBtn(p.playbtn,"on",false)}},winTitle:{init:function(p){document.title=p.songName+" - "+p.artistName},reset:function(){document.title=o}},SongNMSinger:{init:function(t,u){t=t||{};var r=t.artistId,z=t.artistName,v=t.songId,w=t.songName;u.SongNMSinger.reset(u);M3.dispatch(mbox.ACTION.UI_SETALBUM,[""]);if(!!r){var x=r.split(",");var y=z.split(",");var q;var p="";for(var s=0;s<x.length;s++){q=(s!=0)?"，":"";if(x[s]==0){p+=q+'<span class="gray">'+y[s]+"</span>"}else{if(x[s]!=0){p+=q+'<a target="_blank" title="'+y[s]+'" href="'+mbox.url.getArtist(x[s])+'">'+y[s]+"</a>"}}}u.songtit.innerHTML='<a href="'+mbox.url.getSongPage(v)+'" target="blank">'+w+"</a>";u.singer.innerHTML=p;u.titsinger.style.visibility="visible";M3.dispatch(mbox.ACTION.UI_SETALBUM,[p]);if(!this.titScroll){this.titScroll=new M3.setScrollwidth(u.titwarper,u.titcon,n)}else{this.titScroll.init(u.titwarper,u.titcon,n)}}},reset:function(p){p.titsinger.style.visibility="hidden";p.songtit.innerHTML="";p.singer.innerHTML=""}},SongTime:{init:function(){},reset:function(p){p.currTime.innerHTML=j;p.totlTime.innerHTML=k},setCurrTime:function(p,r){if(typeof(p)!="undefined"){var q=M3.convertTime(p);r.currTime.innerHTML=q}},setTotleTime:function(p,r){var q=M3.convertTime(p);r.totlTime.innerHTML=q}},Mutebtn:{init:function(q,p){},setMute:function(p,s,q){var r=s.mutebtn.parentNode.parentNode;q=q||false;if(p||q){h(r,"on");s.volSlider.muteVol()}else{a(r,"on");s.volSlider.restoreVol()}}},PlayMode:{set:function(r,s){var q={"2":s.randombtn,"1":s.singlebtn,"3":s.listbtn};T.object.each(q,function(u,t){a(u,"on")});var p=q[r];if(p){h(p,"on")}}},VolumeSlider:function(p){this.TempVol=p||l;var q=this;this.volSlider=baidu.ui.slider.create({skin:"slider-volume",onslide:function(r){var s=parseInt(r.target.getValue());M3.dispatch(mbox.ACTION.UI_VOLCHANGE,[s]);q.TempVol=s},onslidestart:function(r){},onslidestop:function(r){var s=parseInt(r.target.getValue());if(s==0){M3.dispatch(mbox.ACTION.UI_SETMUTE,[true])}else{M3.dispatch(mbox.ACTION.UI_SETMUTE,[false])}q.TempVol=s},onslideclick:function(r){var s=parseInt(r.target.getValue());q.TempVol=s;this.update({value:q.TempVol});if(q.TempVol==0){M3.dispatch(mbox.ACTION.UI_SETMUTE,[true])}else{M3.dispatch(mbox.ACTION.UI_SETMUTE,[false])}M3.dispatch(mbox.ACTION.UI_VOLCHANGE,[q.TempVol])}});d(this.vSlider,"id",this.wraper+"_vol");this.volSlider.setup(this.vSlider.id);this.volSlider.update({value:this.TempVol});this.volSlider.restoreVol=e(function(){this.volSlider.update({value:this.TempVol})},this);this.volSlider.muteVol=e(function(){this.volSlider.update({value:0})},this);this.volSlider.setVol=e(function(r){this.TempVol=r;this.volSlider.update({value:r})},this)},PlaySlider:function(){this.playSlider=baidu.ui.slider.create({enableLoader:true,skin:"slider-music",onslidestart:function(r){M3.dispatch(mbox.ACTION.UI_PLAYTIMER,[true])},onslidestop:function(r){q(r)},onbeforestartfx:function(){M3.dispatch(mbox.ACTION.UI_PLAYTIMER,[true])},onafterfinishfx:function(){M3.dispatch(mbox.ACTION.UI_PLAYTIMER,[false])},onslideclick:function(r){q(r)}});d(this.plSlider,"id",this.wraper+"_play");this.playSlider.setup(this.plSlider.id);this.playSlider.loaderProgressBar.update({value:0});function q(r){M3.dispatch(mbox.ACTION.UI_PLAY,[r.target.getValue(),true])}var p=this;this.playSlider.setCurrPosition=function(r){p.playSlider.update(r);p.playSlider._adjustProgressbar()}},LoadingState:{init:function(p){},show:function(p,q){p=p||false;if(!p){q.loadingimg.style.display="none"}else{q.loadingimg.style.display="block"}}},favorBtn:{init:function(){},set:function(q,p){this.isfavored=typeof q=="undefined"?!this.isfavored:!!q;p.toggleBtn(p.favor,"on",!this.isfavored);p.favor.title=this.isfavored?"取消收藏":"收藏"}},recomBtn:{init:function(){},set:function(){}},toggleBtn:function(p,q,r){q=q||"on";!!r?a(p,q):h(p,q)},play:function(p){this.Ctrl.init(this,p)},reset:function(){this.winTitle.reset();this.Ctrl.reset(this);this.SongNMSinger.reset(this);this.playSlider.loaderProgressBar.update({value:0});this.SongTime.reset(this);this.favorBtn.set(false,this)}};return i})(window);mbox.ui.PlayList=(function(h,c){var m=T.dom.query;var e=T.fn.bind;var b=T.event.on;var k=T.dom.addClass;var a=T.dom.removeClass;var d=T.dom.setAttr;var f=T.object.each;var j=T.array.each;var i=T.dom.setStyle;var g=T.dom.hasClass;var l=function(){this.tpl='<tr onmouseover="PL.over(this)" onmouseout="PL.out(this)" id="#{trId}">                        <td class="col02"><span>#{index}</span></td>                        <td class="col03"><div class="truncate">#{title}</div></td>                        <td class="col04"><div class="truncate">#{artist}</div></td>                    </tr>';this.clickEvent;this.dblclickEvent;this.delEvent;this.offertoEvent;this.favorEvent;this.downloadEvent;this.hoverBgColor="#ECECEC";this.bgColor="";this.currPlayColor="";this.currPlayClass="currplay";this.selectedColor="#e0f2ff";this.selectedClass="selected";this.oldElem=null;this.btnAbled=false;this.checkeds=0;this.isout=false;this.outTimer=null;this.btnIds={container:".songlist",scrollContainer:"#playListContainer",favor:"#favorbtn",down:"downloadbtn",del:"delbtn",listft:"#listft",loading:"#listloading",listbtn:"#listbtn",floatId:"#playlistfloat"};this.loadingDiv;this.downBtn;this.delBtn;this.listft;this.floatBtn;this.listBtn;this.playtable;this.container;this.scrollContainer;this.playingElem;this.floatDiv};l.prototype={init:function(n){this.initDom(n);this.initTable(n);this.subEvent();this.initFloat()},initDom:function(n){this.container=m(this.btnIds.container);this.scrollContainer=m(this.btnIds.scrollContainer);this.loadingDiv=m("#doc .songlist .loading")[0];this.floatDiv=m(this.btnIds.floatId)[0]},initTable:function(n){this.playtable=new mbox.comm.table({container:n.container,tpl:this.tpl,dblclick:e(function(p,o){if(this.playingElem){a(this.playingElem,this.currPlayClass)}k(o,this.currPlayClass);this.playingElem=o;this.dblclickEvent(p,this.playingElem)},this),beforeDelay:e(function(){this.showLoading(true)},this),afterDelay:e(function(){this.showLoading(false)},this)});if(n.data){this.playtable.create({id:"playTable",trHtml:n.data})}},initEvents:function(n){this.delEvent=n.ondel||function(){};this.downloadEvent=n.ondownload||function(){};this.clickEvent=n.click||function(){};this.dblclickEvent=n.dblclick||function(){}},initFloat:function(){baidu.event.on(this.floatDiv,"click",baidu.fn.bind(function(q){var p=q.target||q.srcElement,o=p.id,n=this.oldElem.rowIndex;switch(o){case this.btnIds.del:this.del(n);break;case this.btnIds.down:this.down(n);break}},this));baidu.event.on(this.floatDiv,"mouseover",baidu.fn.bind(function(n){if(this.outTimer){clearTimeout(this.outTimer)}},this));baidu.event.on(this.floatDiv,"mouseout",baidu.fn.bind(function(n){this.outTimer=setTimeout(function(){if(this.oldElem){this.oldElem.style.backgroundColor=bgColor}if(this.floatDiv){this.floatDiv.style.top="-100px"}this.outTimer=null},100)},this))},subEvent:function(){M3.dispatch(mbox.ACTION.ADDTOPLAYLIST,e(function(n){this.addList(n)},this));M3.dispatch(mbox.ACTION.UPDATELIST,e(function(n){this.update(n)},this));M3.dispatch(mbox.ACTION.REMOVELIST,e(function(n){this.removeList(n)},this));M3.dispatch(mbox.ACTION.SCROLLTO,e(function(n){this.scrollTo(n)},this));M3.dispatch(mbox.ACTION.SETCURRPLAY,e(function(n){this.setCurrPlay(n)},this))},addList:function(o){var n=[];j(o.list,function(q,p){n.push({trId:"",index:"",id:q.songId,title:q.songName,artist:q.artistName})});this.add(n)},add:function(n){if(n&&n.length){this.playtable.addRow(n)}},update:function(n){this.scrollContainer.scrollTop=0;if(n){this.playtable.update(n)}},scrollTo:function(n){this.playtable.moveTo(n)},hiLight:function(n){if(this.oldElem){this.oldElem.style.backgroundColor=this.bgColor}var o=this.playtable.get(n);o.style.backgroundColor=this.hoverBgColor;this.oldElem=o},showLoading:function(n){this.loadingDiv.style.display=n?"block":"none"},setCurrPlay:function(n){if(this.playingElem){a(this.playingElem,this.currPlayClass)}var o=this.playtable.get(n);if(o){k(o,this.currPlayClass);this.playingElem=o}},del:function(o){this.hideFloat();var n=[];if(typeof o!="undefined"){n.push(o)}this.delEvent(n)},removeList:function(o){var n=o.length;if(n>0){this.playtable.removes(o)}},down:function(n){var o=[];if(n!=c){o.push(n)}this.downloadEvent(o)},over:function(n){if(this.oldElem&&this.oldElem!=n){i(this.oldElem,"background-color",this.bgColor)}if(n){if(!g(n,this.selectedClass)){n.style.backgroundColor=this.hoverBgColor}this.oldElem=n;if(this.floatDiv){this.floatDiv.style.top=(parseInt(n.offsetTop)+1)+"px"}if(this.outTimer){clearTimeout(this.outTimer);this.outTimer=null}}},out:function(n){if(n){if(!this.outTimer){this.outTimer=setTimeout(e(function(){i(this.oldElem,"background-color",this.bgColor);this.floatDiv.style.top="-100px";this.outTimer=null},this),100)}}},hideFloat:function(){this.floatDiv.style.top="-100px"}};return l})(window);mbox.namespace("mbox.ui");mbox.ui.Album=(function(i,d){var l=T.dom.query;var g=T.fn.bind;var b=T.event.on;var j=T.dom.addClass;var a=T.dom.removeClass;var e=T.dom.setAttr;var h=T.object.each;var f={albumImg:"images/album_default_small.png"};var c='<span class="coverLink"><img width="90" height="90" class="cover" src="images/album_default_small.png"/></span>';var k=function(m){var n={warper:m.warper};this.wraper=m.wraper;this.Doms={imgwraper:l(n.warper+" .imgwraper")[0],cover:l(n.warper+" .cover")[0],coverLink:l(n.warper+" .coverLink")[0],album:l(n.warper+" .albumName")[0],albumLink:l(n.warper+" .albumLink")[0],artist:l(n.warper+" .singername")[0]};this.init(m)};k.prototype={init:function(m){this.subEvent();this.Doms.album.innerHTML=""},subEvent:function(){M3.dispatch(mbox.ACTION.LOADTITLE,g(function(m){this.setAlbum(m)},this));M3.dispatch(mbox.ACTION.RESET,g(function(){this.resetAlbum()},this))},setAlbum:function(o){var u=o.albumId,v=o.albumName,p=o.artistId,z=o.artistName,r=o.songPicSmall||f.albumImg;if(u&&v&&u!="0"){this.Doms.imgwraper.innerHTML='<a class="coverLink"  href="'+mbox.url.getAlbum(u)+'" title="'+v+'"target="_blank"><img width="90" height="90" class="cover" src="'+r+'"/></a>';this.Doms.album.innerHTML='<a href="'+mbox.url.getAlbum(u)+'" target="_blank" title="'+v+'">《'+M3.overCut(v,20)+"》</a>";this.Doms.albumLink.title=v;this.Doms.albumLink.href=mbox.url.getAlbum(u)}else{this.Doms.imgwraper.innerHTML=c;this.Doms.album.innerHTML=v?v:""}var x=p.split(",");var y=z.split(",");var n;var t;var m="";function w(B,A){return M3.overCut(B,A)}for(var q=0,s=x.length;q<s;q++){n=(q!=0)?" / ":"";if(x[q]==0){m+=n+'<span class="gray">'+y[q]+"</span>"}else{if(x[q]!=0){switch(s){case 1:t=w(y[q],40);break;case 2:t=w(y[q],20);break;case 3:t=w(y[q],12);break;default:t=w(y[q],8)}m+=n+'<a target="_blank" title="'+y[q]+'" href="'+mbox.url.getArtist(x[q])+'">'+t+"</a>"}}}this.Doms.artist.innerHTML=m},resetAlbum:function(){this.Doms.albumLink.innerHTML=this.Doms.albumLink.title="";this.Doms.albumLink.href="#";this.Doms.album.innerHTML="";l(".cover")[0].src="images/album_default_small.png";this.Doms.coverLink.href="#";this.Doms.coverLink.title="";this.Doms.artist.innerHTML=this.Doms.artist.title="";this.Doms.artist.href="#"}};return k})(window);mbox.ui.albumInstance=new mbox.ui.Album({warper:".mb-album"});mbox.lrc=(function(){var a=T.g;var p=T.dom.query;var l=T.fn.bind;var h=T.event.on;var m=T.dom.addClass;var i=T.dom.removeClass;var e=T.browser.ie;var q=T.dom.setAttr;var t=T.object.each;var b=T.ajax.request;var j=T.json.parse;var g=T.string.trim;var c=location.host;var d="qukufile.qianqian.com";var f={};var n="";var s={evaluate:function(w){try{return j(w)}catch(x){return w}},checkCallback:function(w){w=w||{};w.onsuccess=w.onsuccess||function(){};w.onfailure=w.onfailure||function(){};return w},convertXHR:function(w){return s.evaluate(w&&w.responseText)},checkData:function(w){return typeof w.errorCode!="undefined"},regTrim:/(^\s*)(\s*$)/g,regTimeTag:/\[\d{2}:\d{2}(?:(\.|:)\d{2,5})?\]/g,regLrctext:/\[[\w\W]*\]/g,regBracket:/\[|\]/g,msecParse:function(z){var A=z.indexOf(":");if(!this.checkTimeTagIndex(z)){return}var w=z.length,y,x;y=z.substring(0,A)*60*1000;x=z.substring(A+1,w).replace(/\D/,".")*1000;return parseInt(y+x)},checkTimeTagIndex:function(w){var x=w.indexOf(":");return !(w==""&&x<0)},checkTimeTag:function(w){var x=s.regTimeTag.test(w);s.regTimeTag.lastIndex=0;return x},convertTime:function(y){var z,w,x;x=Math.floor(y%1000);y/=1000;z=Math.floor(y/60);w=Math.floor(y%60);return baidu.number.pad(z,2)+":"+baidu.number.pad(w,2)+"."+x}};var r={line:function(x,z,y,w){return z*(x/=y)*x+w}};var o={getLrcData:function(x,w){var z=x.lrcLink;var y=x.songId;w=s.checkCallback(w);if(z.length==0){w.onfailure();return}if(f[y]){w.onsuccess(f[y])}else{z=z.replace(d,c);b(z,{onsuccess:function(B){var A=s.convertXHR(B);w.onsuccess(A);f[y]=A},onfailure:function(){w.onfailure()}})}}};var v={getLrcData:function(w,x){o.getLrcData(w,{onsuccess:function(y){v.cb_showLrc(y,x);M3.dispatch(mbox.ACTION.NOLRC,["true"])},onfailure:function(y){v.cb_clearLrc(x)}})},cb_showLrc:function(x,y){i(y.Doms.wraper,"overauto");if(!s.checkTimeTag(x)){m(y.Doms.wraper,"overauto");y.Doms.wraper.innerHTML=x.replace(/\r|\n/g,"<br/>");y.lrcTextData=x;n="txt";return}n="lrc";y.parseData(x);if(!y.UI){var w={id:y.args.id,currClass:"curr"};y.args=w;y.UI=new u(y)}else{y.UI.init(w)}},cb_clearLrc:function(w){log("show Lrc success");w.setNoneLrc()}};var u=(function(){var w=function(x){_instance=x;this.init.apply(this,[]);this.wraper};w.prototype={init:function(){_instance.reset();this.buildDoms()},buildDoms:function(){var B=document.createDocumentFragment();var z=document.createElement("UL");var C="";var D=_instance.orgData;this.wraper=_instance.Doms.wraper;this.wraper.innerHTML="";for(var A=0,x=D.length;A<x;A++){C=D[A];oLi=document.createElement("li");oLi.lang=A+"|"+C[0];var y=(!C[1].replace(s.regTrim,""))?"&nbsp;":C[1];oLi.innerHTML=y;B.appendChild(oLi)}z.appendChild(B);this.wraper.appendChild(z);this.wraper.scrollTop=0;return this},doSync:function(y){if(this.currLine==0&&n=="lrc"){this.wraper.scrollTop=0}var x=this.wraper.getElementsByTagName("li").length;if(!s.checkTimeTagIndex(y)||!_instance.hasLrc||x==0){return this}this.findCurrLine(y).setCurrentStyle();return this},setPosition:function(x){if(this.scrolltimer){clearTimeout(this.scrolltimer)}this.findCurrLine(x);if(!this.currLine){return}if(typeof(this.preLine)!="undefined"){this.preLine.className=""}this.currLine.className="curr";this.oLi=this.wraper.getElementsByTagName("li");var E=this;var A=this.wraper.offsetHeight/2;var z=this.oLi[this.currLine].offsetTop;var C=this.oLi[this.currLine].clientHeight;var B=42;if(e!=undefined&&e==6){B=0}var y=this.wraper.scrollTop;var D=z-y-A-B;this.wraper.scrollTop+=D;this.preLine=this.currLine},findCurrLine:function(y){var C=_instance.currClass;var B=s.msecParse(y);var A=_instance.orgData;for(var z=0,x=A.length;z<=x;z++){if(z<x&&A[z][0]>=B){this.currLine=z>0?z-1:0;break}else{if(z==x){this.currLine=x-1}}}return this},setCurrentStyle:function(y){if(this.currLine&&this.currLine==this.preLine){return this}var z,x;z=_instance.args.currClass;this.oLi=this.wraper.getElementsByTagName("li");x=this.oLi.length;if(this.preLine==undefined){this.preLine=0}else{this.oLi[this.preLine].className=""}this.oLi[this.currLine].className=z;this.preLine=this.currLine;this.doScroll()},storeOffsetTop:function(){this.oLi=this.wraper.getElementsByTagName("li");var z;for(var y=0,x=this.oLi.length;y<x;y++){z=this.oLi[y];_instance.orgData[y][2]=z.offsetTop}return this},doScroll:function(){this.oLi=this.wraper.getElementsByTagName("li");var z=this;var F=this.wraper.offsetHeight/2;var A=this.oLi[this.currLine].offsetTop;var E=this.oLi[this.currLine].clientHeight;var C=-28;var y=this.wraper.scrollTop;var x=A-y-F-C;var G=0,B=15;if(this.scrolltimer){clearTimeout(this.scrolltimer);this.scrolltimer=null}function D(){z.wraper.scrollTop=r.line(G,x,B,y);G++;if(G<=B){z.scrolltimer=setTimeout(D,30)}}D();return this}};return w})();var k=function(w){this.LogicInit=function(x,y){v.init(x,y)};this.args=w;this.orgData=[];this.lrcTextData=[];this.MsecLine={};this.Doms={wraper:(function(){return p(w.Dompath)[0]})()};this.Mark=/\r|\n/;this.Data=s;this.animotion=r;this.init.apply(this,[w])};k.prototype={init:function(w){this.reset();this.subEvent()},subEvent:function(w){M3.dispatch(mbox.ACTION.LOADTITLE,l(function(x){v.getLrcData(x,this)},this));M3.dispatch(mbox.ACTION.UPDATEPLAYED,l(function(x){this.UI&&this.UI.doSync(s.convertTime(x.curtime))},this));M3.dispatch(mbox.ACTION.RESET,l(function(){this.reset()},this))},parseData:function(w){w=w.replace(s.regTrim,"");w=w.split(this.Mark);this.orgData=w;this.hasLrc=true;this.setOrgData().sortData()},setOrgData:function(y,A){y=y||this.orgData;var B=[];var F=[];var G=[];var C,D,z,E;for(var x=0;x<y.length;x++){s.regTimeTag.lastIndex=0;C=s.regTimeTag.test(y[x]);F=[];if(C){G=y[x].match(s.regTimeTag);D=G.length;z=y[x].replace(s.regLrctext,"");if(D==1){F[0]=s.msecParse(y[x].match(s.regTimeTag).toString().replace(s.regBracket,""));F[1]=y[x].replace(s.regLrctext,"");B.push(F)}else{if(D>1){for(var w=0;w<D;w++){E=[];E[0]=s.msecParse(G[w].replace(s.regBracket,""));E[1]=z;B.push(E)}}}}}this.orgData=B;A&&A(B);B=null;return this},sortData:function(w,x){w=w||this.orgData;w.sort(function(z,y){return z[0]-y[0]});this.lrcTextData=w;M3.dispatch(mbox.ACTION.COPYLRC,[w]);this.orgData=w;x&&x(w);return this},addListening:function(){},resetTop:function(){this.Doms.wraper.scorllTop=0},reset:function(){this.Doms.wraper.innerHTML="";this.resetTop();if(this.UI){this.UI.preLine=0;this.UI.currLine=0}i(this.Doms.wraper,"nolrc");i(this.Doms.wraper,"overauto")},setNoneLrc:function(){this.reset();m(this.Doms.wraper,"nolrc");M3.dispatch(mbox.ACTION.NOLRC,["false"]);this.hasLrc=false;return this}};return k})();var param={Dompath:".mb-lrcwraper",currClass:"curr"};if(!mbox.olrc){mbox.olrc=new mbox.lrc(param)}else{mbox.olrc.init(param)}mbox.songlist=(function(){var lis=0;var foldmod=false;var maxNum=200;var maxSonglistNum=50;var SONGLIST;var _g=T.g,_query=T.dom.query,_bind=T.fn.bind,_EventOn=T.event.on,_EventUn=T.event.un,_getTarget=T.event.getTarget,_once=T.event.once,_addClass=T.dom.addClass,_hasClass=T.dom.hasClass,_removeClass=T.dom.removeClass,_setAttr=T.dom.setAttr,_setStyle=T.dom.setStyle,_getStyle=T.dom.getStyle,_objectEach=T.object.each,_ajax=T.ajax.request,_parseJSON=T.json.parse,_trim=T.string.trim,_encodeHTML=T.string.encodeHTML,_stopPropagation=T.event.stopPropagation,_getAncestorByClass=T.dom.getAncestorByClass;var _Util={ArrayUnique:function(myArray){var newArray=[];var provisionalTable={};for(var i=0,item;(item=myArray[i])!=null;i++){if(!provisionalTable[item]){newArray.push(item);provisionalTable[item]=true}}return newArray},overCut:function(str){if(str.length>15){str="[ "+str.substring(0,13)+"... ]"}else{str="[ "+str+" ]"}return str},evaluate:function(v){try{return _parseJSON(v)}catch(e){return v}}};var _Data={createSongList:function(name,defname,cb){mbox.data.createPlayList(name,defname,{onsuccess:_bind(function(data){switch(data.errorCode){case mbox.CODEMAP.SUCCESS:cb.onsuccess(data);break;case mbox.CODEMAP.LISTDUP:cb.onlistdup(data);break;case mbox.CODEMAP.UNLOGIN:break}},this),onfailure:function(xhr){}})},getPlayListDetail:function(songlistId,ids,cb){mbox.data.getPlayListDetail(songlistId,{onsuccess:_bind(function(data){switch(data.errorCode){case mbox.CODEMAP.SUCCESS:cb.onsuccess(data.data.songIds);break;case mbox.CODEMAP.NOTEXIST:cb.notexist(data);break;case mbox.CODEMAP.UNLOGIN:break}},this),onfailure:function(){}})},getSongListName:function(cb){mbox.data.getPlayListName({onsuccess:_bind(function(data){switch(data.errorCode){case mbox.CODEMAP.SUCCESS:cb(data.data.play_list);break;case mbox.CODEMAP.UNLOGIN:break}},this),onfailure:function(){}})},getDefaultTitle:function(cb){var url="/data/playlist/getname";_ajax(url,{onsuccess:function(xhr){var data=_Util.evaluate(xhr.responseText);var errorCode=data.errorCode;switch(errorCode){case mbox.CODEMAP.SUCCESS:cb.onsuccess(data);break;case mbox.CODEMAP.LISTLIMIT:cb.onlimited(data);break}},onfailure:function(xhr){cb.onfailure(xhr)},noCache:true})},savePlayList:function(playListId,ids,cb){mbox.data.savePlayList(playListId,ids,{onsuccess:function(data){cb.onsuccess(data)},onfailure:function(data){switch(data.errorCode){case mbox.CODEMAP.LISTDUP:cb.listTdUp(data);break;case mbox.CODEMAP.LISTLIMIT:cb.listLimit(data);break}}})}};_UI=(function(){var fn=function(instance){this.init.apply(this,[instance])};fn.prototype={init:function(instance){instance.parseData(this.buildDoms,instance)},buildDoms:function(data,instance){var oFragment=document.createDocumentFragment();var oUl=instance.Doms.list.getElementsByTagName("UL")[0];var oLi;var item;var len=data.length;var maxheightClass="maxheight";var nolistClass="nolist";if(!foldmod){_removeClass(oUl,"maxheight-fold");if(len>6){_addClass(oUl,"maxheight")}else{_removeClass(oUl,"maxheight")}}else{_removeClass(oUl,"maxheight");if(len>2){_addClass(oUl,"maxheight-fold")}else{_removeClass(oUl,"maxheight-fold")}}if(data.length==0){_setStyle(oUl,"display","none");_addClass(oUl.parentNode,nolistClass)}else{_setStyle(oUl,"display","block");_removeClass(oUl.parentNode,nolistClass)}for(var i=0;i<len;i++){item=data[i];var oLi=document.createElement("LI");oLi.innerHTML='<a class="songlistitem" title="'+item.listTitle+'" href="javascript:void(0);" lang="'+item.listId+"|"+item.listTotal+'" onclick="return false;"  onfocus="this.blur()">'+_Util.overCut(item.listTitle)+" ("+item.listTotal+")</a>";oFragment.appendChild(oLi)}oUl.innerHTML="";oUl.appendChild(oFragment);return this}};return fn})();var Constructor=function(args){SONGLIST=this;this.LogicInit=function(args,_this){_LOGIC.init(args,_this)};this.args=args;this.songlist;this.orgData=[];var getDoms=function(queryStr){return _query(queryStr)[0]};this.Doms={list:getDoms(args.Dompath.box+" "+args.Dompath.list),listul:getDoms(args.Dompath.box+" "+args.Dompath.listul),btn:getDoms(args.Dompath.box+" "+args.Dompath.btn),btnnewlist:getDoms(args.Dompath.box+" "+args.Dompath.btnNewlist),onlyname:getDoms(".songlistpop .only .name"),onlybtns:getDoms(".songlistpop .only .btns"),onlysave:getDoms(".songlistpop .only .btns .save"),onlycancel:getDoms(".songlistpop .only .btns .cancel"),songlistname:getDoms(".songlistpop .con .songlistname"),con_note:getDoms(".songlistpop .con .note"),savebtn:getDoms(".songlistpop .con .save"),songlistcon:getDoms(".songlistpop .songlistcon"),createname:getDoms(".songlistpop .create .name"),createnote:getDoms(".songlistpop .create .note span"),addname:getDoms(".songlistpop .add .name"),addnote:getDoms(".songlistpop .add .note span"),songlist_tit:getDoms(".songlistpop .popcon .tit"),concancel:getDoms(".songlistpop .con .cancel")};this.popup=mbox.ui.dialog.songlist;this.SongListInfo;this.isContinue=false;this.addListening();this.init.apply(this,[args])};Constructor.prototype={init:function(args){this.reset();this.subEvent()},subEvent:function(){M3.dispatch(mbox.ACTION.SHOWPLAYLIST,_bind(function(e){var _this=this;_this.toggle(e)},this));M3.dispatch(mbox.ACTION.FOLDMOD,_bind(function(isfold){this.changeHeight(isfold)},this))},parseData:function(cb,_that){_Data.getSongListName(function(data){_that.songlist=data;if(cb){cb(data,_that)}})},setOrgData:function(data,callback){},addListening:function(){var _this=this;var btn=this.Doms.btn;var _onlysave=this.Doms.onlysave;var _onlycancel=this.Doms.onlycancel;var _songlistname=this.Doms.songlistname;var _con_note=this.Doms.con_note;var _con_name=this.Doms.con_name;var _savebtn=this.Doms.savebtn;var _cancelbtn=this.Doms.concancel;_EventOn(btn,"click",this.pubshow);_EventOn(_savebtn,"click",function(e){if(_songlistname.value.replace(/(^\s*)|(\s*$)/g,"")==""){_con_note.innerHTML="歌单名不能为空";_addClass(_savebtn,"disable")}if(!_hasClass(_savebtn,"disable")){_this.checkCreate(_songlistname.value)}});_EventOn(_onlysave,"click",_bind(function(e){SONGLIST.isContinue=true;this.popupSave(e)},this));_EventOn(_onlycancel,"click",function(){SONGLIST.isContinue=false;_this.popup.close()});_EventOn(_cancelbtn,"click",function(){_this.popup.close()});_EventOn(_songlistname,"keyup",function(e){if(_songlistname.value!=""){if(_songlistname.value.replace(/(^\s*)|(\s*$)/g,"").length>20){_con_note.innerHTML="歌单名不能超过20字符";_addClass(_songlistname,"redborder");_addClass(_savebtn,"disable")}else{_con_note.innerHTML="";_removeClass(_songlistname,"redborder");_removeClass(_savebtn,"disable")}}})},popupSave:function(){var _this=this;var _btns=this.Doms.onlybtns;var ids=this.newIds;var _onlyname=this.Doms.onlyname;var _info=_onlyname.lang.split(",");var _remain=maxNum-_info[1];var _tit,_ids;_onlyname.innerHTML='<div class="loading_img"></div>';_btns.style.display="none";if(this.newSonglistName!=""&&this.newSonglistName!=undefined){ids=this.currSonglist.slice(0,maxNum);_tit=this.newSonglistName;this.cb_saveCleate(_tit,SONGLIST.defname,{onsuccess:function(info){txt=info[2];_this.cb_saveAdd(info,"create",ids)}});this.newSonglistName=""}else{_ids=SONGLIST.FilteredIds.slice(0,_remain);_this.cb_saveAdd(_info,"add",_ids)}},reset:function(){var el=this.Doms.list.parentNode;var _savebtn=this.Doms.savebtn;_removeClass(el,"btnshow");_removeClass(_savebtn,"disable")},toggle:function(e){_stopPropagation(e);var target=_getTarget(e);var warper=this.Doms.list.parentNode;var btn=this.Doms.btn;var tagshow="btnshow";var tag="songlistitem";var newlistTag="newlist";this.currSonglist=mbox.logic.listCtrl.showList._songIdList;if(!this.checkTarget(e)&&target.parentNode!==btn){this.hidden(e)}else{if(target.parentNode==btn){if(!_hasClass(warper,tagshow)){this.reset();this.show()}else{this.hidden()}}else{if(target.className!=""&&_hasClass(target,tag)){var info=target.lang.split("|");info.push(_Util.overCut(target.title));this.addtoSongList(info)}else{if(target.parentNode.className!=""&&_hasClass(target.parentNode,newlistTag)){this.createSongList()}else{this.hidden()}}}}},show:function(){var _this=this;var warper=this.Doms.list.parentNode;var etype="click";var tagshow="btnshow";var body=_query("body")[0];var btn=this.Doms.btn;var deviceJSON={songLimit:false,playlist:true};mbox.user.checklogin(true,function(data){_this.changeHeight();if(!_this.UI){_this.UI=new _UI(_this)}else{_this.UI.init(_this)}_addClass(warper,tagshow);_EventOn(body,"click",_this.pubshow)},deviceJSON);M3.dispatch(mbox.ACTION.CLK,["opensonglist"])},hidden:function(){var warper=this.Doms.list.parentNode;var tagshow="btnshow";var etype="click";var btn=this.Doms.btn;var el=this.Doms.list.parentNode;var body=_query("body")[0];_removeClass(warper,tagshow);_EventUn(body,etype,this.pubshow)},pubshow:function(e){M3.dispatch(mbox.ACTION.SHOWPLAYLIST,[e])},checkTarget:function(e){var target=_getTarget(e);var isHidden=false;var whitelist=["btnsave","list"];var item;for(var i=0,len=whitelist.length;i<len;i++){item=whitelist[i];if(_getAncestorByClass(target,item)){isHidden=true;break}}return isHidden},changeHeight:function(isfold){if(isfold==undefined){isfold=foldmod}if(isfold){_addClass(this.Doms.list,"fold");if(SONGLIST.Doms.listul.getElementsByTagName("LI").length>2){_addClass(SONGLIST.Doms.listul,"maxheight-fold")}_removeClass(this.Doms.listul,"maxheight");foldmod=true}else{_removeClass(this.Doms.list,"fold");if(SONGLIST.Doms.listul.getElementsByTagName("LI").length>6){_addClass(SONGLIST.Doms.listul,"maxheight")}_removeClass(SONGLIST.Doms.listul,"maxheight-fold");foldmod=false}},checkOverCut:function(sum,val,cb){if(sum>maxNum){this.Doms.songlistcon.className="remain songlistcon clearfix";this.Doms.onlybtns.style.display="none";this.Doms.onlyname.innerHTML="歌单只能塞下"+parseInt(maxNum)+"首，要保存么？";this.Doms.onlyname.lang=parseInt(maxNum);this.Doms.onlybtns.style.display="block";this.newSonglistName=val}else{this.newSonglistName="";if(cb){cb(val)}}},addtoSongList:function(info,cb){var _this=this;_this.SongListInfo=info;var playListId=info[0];var total=info[1]*1;var txt=info[2];var _name=this.Doms.addname;var _note=this.Doms.addnote;var _onlyname=this.Doms.onlyname;var _popup="";var _songlistcon=this.Doms.songlistcon;var _title=this.Doms.songlist_tit;var _btns="";var _onlysave=this.Doms.onlysave;var _onlycancel=this.Doms.onlycancel;var _max=maxNum;var _remain;var _len;var _sum;M3.dispatch(mbox.ACTION.EXPANDMOD,[true]);if(SONGLIST.Doms.listul.getElementsByTagName("LI").length>6){_addClass(SONGLIST.Doms.listul,"maxheight")}_removeClass(SONGLIST.Doms.listul,"maxheight-fold");if(!this.checkCurrlist()){return}this.checkrepeatsong(playListId,this.currSonglist,function(ids){_remain=_max-ids.length;_len=ids.length;_sum=_len+total;setTimeout(function(){_this.popup.show(total,function(popup){_popup=popup;_songlistcon.className="adddone songlistcon clearfix";_btns=_query("#"+_popup.mainId+" .only .btns")[0];_num=_query("#"+_popup.mainId+" .remain .only .name span")[0];_name.innerHTML='<div class="loading_img"></div>';_note.style.display="none";_title.style.display="none";if(total>=_max){_songlistcon.className="remain songlistcon clearfix";_btns.style.display="none";_onlyname.innerHTML="塞满"+maxNum+"首了，木有地方啦!~";window.setTimeout(function(){_popup.close()},2000);return}if(_len==0){_this.cb_savePlayList("add",info);return}if(_sum>_max){_songlistcon.className="remain songlistcon clearfix";_btns.style.display="none";_onlyname.innerHTML="再放"+parseInt(maxNum-total)+"首，就到"+maxNum+"首了，要保存么？";SONGLIST.FilteredIds=ids;_onlyname.lang=info;_btns.style.display="block"}else{var _info=[];_info[0]=playListId;_info[2]=txt;_this.cb_saveAdd(info,"add",ids)}if(cb!=undefined){cb()}})},50)})},checkCurrlist:function(cb){var _this=this;if(this.currSonglist.length==0){this.Doms.songlistcon.className="adddone songlistcon clearfix";this.Doms.addname.innerHTML="当前播放列表无歌曲";this.Doms.addnote.style.display="none";this.Doms.songlist_tit.style.display="none";setTimeout(function(){_this.popup.show("",function(pop){_this.Doms.addname.innerHTML="当前播放列表无歌曲";_this.Doms.addnote.style.display="none";_this.Doms.songlist_tit.style.display="none";window.setTimeout(function(){pop.close()},2000)})},50);return false}else{return true}},cb_savePlayList:function(action,info){var _this=this;var _popup=this.popup;var _songlistcon=this.Doms.songlistcon;var _name=eval("_this.Doms."+action+"name");var _note=eval("_this.Doms."+action+"note");var link="/playlist/"+info[0];_name.innerHTML='<a href="'+link+'" target="blank">'+_encodeHTML(info[2])+"</a>";_note.style.display="inline";_songlistcon.className=action+"done songlistcon clearfix";this.UI.init(this)},checkrepeatsong:function(listId,ids,cb){var _this=this;this.newIds;var _newIds=[];var _tempData={};_Data.getPlayListDetail(listId,ids,{onsuccess:function(data){for(var i=0,item,len=data.length;i<len;i++){item=data[i];_tempData[item]=true}for(var i=0,item,len=ids.length;i<len;i++){item=ids[i];if(!_tempData[item]){_newIds.push(item)}}_this.newIds=_newIds;cb(_newIds)},notexist:function(data){var _title=_this.Doms.songlist_tit;var _name=_this.Doms.addname;var _note=_this.Doms.addnote;var _songlistcon=_this.Doms.songlistcon;_name.innerHTML="对不起，这个歌单不见了";_songlistcon.className="adddone songlistcon clearfix";_note.style.display="none";_title.style.display="none";_this.UI.init(_this);_this.popup.show("",function(pop){window.setTimeout(function(){pop.close();_name.innerHTML=""},2000)});return}})},createSongList:function(){var _this=this;M3.dispatch(mbox.ACTION.EXPANDMOD,[true]);if(SONGLIST.Doms.listul.getElementsByTagName("LI").length>6){_addClass(SONGLIST.Doms.listul,"maxheight")}_removeClass(this.Doms.listul,"maxheight-fold");if(!this.checkCurrlist()){return}setTimeout(function(){_this.popup.show("",function(pop){_this.cb_showCreate.apply(_this,[pop])})},50)},cb_createdone:function(listTitle){var _this=this;var _name=this.Doms.createname;var _create_note=this.Doms.createnote;_create_note.style.display="inline";_name.innerHTML=_Util.overCut(listTitle);this.UI.init(this);window.setTimeout(function(){_this.popup.close()},2000)},cb_showCreate:function(){var _savebtn=this.Doms.savebtn;var _cancelbtn=this.Doms.concancel;var _songlistcon=this.Doms.songlistcon;var _con_note=this.Doms.con_note;var _title=this.Doms.songlist_tit;var _songlistname=this.Doms.songlistname;var _songlistname=this.Doms.songlistname;var _onlyname=this.Doms.onlyname;var _onlybtns=this.Doms.onlybtns;_songlistcon.className="songlistcon clearfix";_con_note.innerHTML="";_songlistname.value="";_removeClass(_songlistname,"redborder");_Data.getDefaultTitle({onsuccess:function(data){SONGLIST.defname=data.title;_songlistname.value=SONGLIST.defname;_songlistname.select();_title.style.display="block"},onlimited:function(){_songlistcon.className="remain songlistcon clearfix";_onlybtns.style.display="none";_onlyname.innerHTML="歌单已达最大数量"+maxSonglistNum+"首，不能再创建了~";window.setTimeout(function(){SONGLIST.popup.close()},2000);return}})},checkCreate:function(val){val=val.replace(/(^\s*)|(\s*$)/g,"");var _savebtn=this.Doms.savebtn;var _songlistcon=this.Doms.songlistcon;var _name=this.Doms.createname;var _create_note=this.Doms.createnote;var _con_note=this.Doms.con_note;var _max=maxNum;var _sum=this.currSonglist.length;var _btns=this.Doms.onlybtns;var _onlyname=this.Doms.onlyname;var total;this.newIds=this.currSonglist;if(val.length<=20&&!_hasClass(_savebtn,"disable")){_songlistcon.className="createdone songlistcon clearfix";_name.innerHTML='<div class="loading_img"></div>';_create_note.style.display="none";this.checkOverCut(_sum,val,this.cb_saveCleate)}else{_con_note.innerHTML="歌单名不能超过20字符"}},cb_saveAdd:function(info,action,ids){_Data.savePlayList(info[0],ids,{onsuccess:function(data){SONGLIST.cb_savePlayList(action,info)},onfailure:function(data){}})},cb_saveCleate:function(val,defname,cb,ids){var _info=[];defname=defname||SONGLIST.defname;ids=ids||SONGLIST.currSonglist;_Data.createSongList(val,defname,{onsuccess:function(data){_info[0]=data.data.listId;_info[1]=0;_info[2]=_Util.overCut(data.data.listTitle);if(cb){cb.onsuccess(_info)}else{SONGLIST.cb_saveAdd(_info,"create",ids)}},onlistdup:function(){SONGLIST.Doms.songlistcon.className="songlistcon clearfix";SONGLIST.Doms.con_note.innerHTML="有这个名字了，换一个试试吧";_addClass(SONGLIST.Doms.savebtn,"disable")},listLimit:function(data){}})}};return Constructor})();if(!mbox.songlistInstance){var param={box:"#doc",btn:".feedbackwraper .btnsave",list:".feedbackwraper .list",listul:".feedbackwraper .list ul",btnNewlist:".feedbackwraper .list .newlist a"};mbox.songlistInstance=new mbox.songlist({Dompath:param})}else{mbox.songlistInstance.init(param)}mbox.fClipborad=(function(){var b="fClipboard",d=0,a,c;var e=function(){this.swf=null;this.flashId=b+"_"+(d++);this.timeId=null;this.retryTime=0};var f=T.fn.bind;e.prototype={init:function(g){if(!this.swf){baidu.swf.create({id:this.flashId,url:g.swf||"fClipboard.swf",width:g.width,height:g.height,errorMessage:"载入FLASH出错",wmode:"transparent",vars:"width="+g.width+"&height="+g.height,ver:"9.0.0"},g.flashContainerId);this.timeId=setInterval(baidu.fn.bind(function(){var h=baidu.swf.getMovie(this.flashId);if(h.flashInit){this.swf=h;clearInterval(this.timeId);this.swf.setHandCursor(typeof g.handCursor=="undefined"?true:g.handCursor);this.swf.setContentFuncName(g.contentFuncName);this.swf.setMEFuncName(g.mouseEventFuncName)}else{if(this.retryTime++>100){clearInterval(this.timeId)}}},this),500)}this.subEvent()},subEvent:function(){M3.dispatch(mbox.ACTION.NOLRC,f(function(g){this.setNoLrc(g)},this));M3.dispatch(mbox.ACTION.RESET,f(function(g){this.setNoLrc("false")},this))},setNoLrc:function(g){a=T.g("flashcontent");dnocontent=T.dom.query(".clipbtn_nocontent")[0];if(g==="true"){a.className="clipbtn";dnocontent.style.display="none"}else{a.className="";dnocontent.style.display=""}}};return e})();mbox.clip={getPasteData:function(){var e="";var d=mbox.olrc.lrcTextData||"";if(d.pop){for(var b=0,a=d.length,c;b<a;b++){c=d[b][1]+"\n";e+=c}}else{e=d}return e},mouseEventHandler:function(a){dflashcontent=T.g("flashcontent");dsuccess=T.dom.query(".clipbtn_success")[0];switch(a){case"mouse_over":dflashcontent.className="clipbtn_hover";break;case"mouse_out":dflashcontent.className="clipbtn";break;case"mouse_down":break;case"mouse_up":T.fx.fadeIn(dsuccess,{onafterupdate:setTimeout(function(){interval:3,T.fx.fadeOut(dsuccess)},2000)});break}}};mbox.flashclip=new mbox.fClipborad();mbox.flashclip.init({swf:"flash/fClipboard.swf",flashContainerId:"flashcontent",width:195,height:30,handCursor:true,contentFuncName:"mbox.clip.getPasteData",mouseEventFuncName:"mbox.clip.mouseEventHandler"});
MI.TalkBoxRich=1;(function(){var o=UI.G,d=UI.GC;if(!window.MIApp||window.MIApp.lib)window.$=UI.G,window.$$=UI.GC;MI.PicTurn={pos:0,url:"http://upload.t.qq.com",path:"",cache:[],build:function(a){var b=this,c="imageRotate"+MI.random();b.talkBox=a;b._body=UI.html("<div "+(UI.B.ie6?"":'class="big"')+' style="display:none;margin:3px 0 8px;padding:4px;border:1px solid #e5e5e5;background:#f9f9f9;position:absolute;z-index:20;top:15px;left:0px;"><div class="tools"'+("en_US"==window.MILang?'style="width:200px"':'style="width:130px"')+'><a class="btnBack" href="#" style=""><em'+(UI.B.ie6?" style=\"width:17px;background:url('http://mat1.gtimg.com/www/mb/images/b2_100907.png') no-repeat scroll -162px -233px transparent;\"":"")+"></em>"+_("向左转")+'</a><span>|</span><a class="btnPrev" href="#"><em'+(UI.B.ie6?" style=\"width:17px;background:url('http://mat1.gtimg.com/www/mb/images/b2_100907.png') no-repeat scroll -179px -233px transparent;\"":"")+"></em>"+_("向右转")+'</a></div><div class="loading" style="width:112px;line-height:1.231;height:19px;_height:21px;display:none;">'+_("处理中")+'...</div><div class="imgct" style="clear:both;text-align:center;_width:160px;"></div><form method="POST" target="'+c+'" action="/asyn/rotatepic.php"><input type="hidden" id="irRetType" name="retType" value="0" /><input type="hidden" id="irPath" name="path" /><input type="hidden" id="irDegrees" name="degrees" /></form><iframe id="'+c+'" name="'+c+'" src="about:blank" style="display:none"></iframe></div>')[0];b._imgCt=d(b._body,".imgct")[0];b._picLoading=d(b._body,".loading")[0];b._tools=d(b._body,".tools")[0];b._form=d(b._body,"form")[0];d(b._body,".btnPrev")[0].onclick=function(){this.blur();b.turn(1);MI.Bos("btnPicTurn");return!1};d(b._body,".btnBack")[0].onclick=function(){this.blur();b.turn(-1);MI.Bos("btnPicTurn");return!1};b._body.onmouseover=function(){clearTimeout(b.hl);b.show()};b._body.onmouseout=function(){b.hide()};return b._body},turn:function(a){this.pos+=a;3<this.pos?this.pos-=4:0>this.pos&&(this.pos+=4);(a=this.cache[this.pos])?(this.talkBox.pic=a,this.set(a)):this.get()},get:function(){UI.hide(this._tools);this._picLoading.style.display="block";UI.A(this._form,"action",MI.PicTurn.url+"/asyn/rotatepic.php");o("irPath").value=this.path;o("irDegrees").value=90*this.pos;this._form.submit()},over:function(a){0==a.result&&(a=a.info.image,this.talkBox.pic=a,this.cache[this.pos]=a,this.set(a));UI.hide(this._picLoading);UI.show(this._tools)},set:function(a){var b=this;b._imgCt.innerHTML='<img src="'+a+'/160" /><br /><div style="display:'+(UI.B.ipad?"none":"inline")+';white-space:nowrap;"><a href="#" class="useFilter" style="float:none;display:inline-block;padding:5px 0;">'+_("魔法滤镜")+"</a></div>";d(b._imgCt,".useFilter")[0].onclick=function(){MI.app({Base:function(){var c=a.replace("mblogpic.store.qq.com/mblogpic","t0.qpic.cn/mblogpic");MI.photoFilter.build(c+"/2000","http://api.t.qq.com/asyn/updateGrabPic.php");MI.TalkBox.cur=b.talkBox}});MI.Bos("btnPhotoFilter");return!1}},show:function(){clearTimeout(this.autoHideDelay);UI.show(this._body)},hide:function(){UI.hide(this._body)},hideT:function(){var a=this;a.hl=setTimeout(function(){a.hide()},200)},reset:function(a,b){this.pos=0;this.path=b;this.cache=[a];this.set(a);UI.hide(this._picLoading);UI.show(this._tools)}};MI.TalkBox.prototype.uploadPic=function(){this.upPic.flashCapture?UI.addClass(this.upPic._picCapture[1],"loading"):(this.upPic.hide(),UI.append(this._uploadPicS,this._sendStatus),!UI.hasClass(this._sendCnt,"hasMedia")&&UI.addClass(this._sendCnt,"hasMedia"),UI.show(this._picLoading),UI.addClass(this._picLoading,"loading"));MI.TalkBox.cur=this};MI.TalkBox.prototype.qbUploadCookie=function(){return document.cookie};MI.TalkBox.prototype.qbUploadPosition=function(){return d(this.upPic._picForm,"input")[0]};MI.TalkBox.prototype.qbUploadAddPic=function(a){a&&a.info&&!a.info.fileName&&(a.info.fileName=_("图片.jpg"));this.addPic(a)};MI.TalkBox.prototype._addMusic=function(a){var b=this,c;if(a.music||a.mlist)a.music&&(b.music=a.music,b.mlist=""),a.mlist&&(b.mlist=a.mlist,b.music=""),b._music&&MI.app({Music:function(){b.music&&b.music.id?(UI.A(b._music,"music",""+b.music.id+","+b.music.songurl+","+b.music.singer+","+b.music.song+",3"),c=2):b.mlist&&(UI.A(b._music,"music",""+b.mlist.uin+","+b.mlist.url+",,"+b.mlist.name+",3"),c=3);MI.Music.addPreview(b._music,"",c);MI.Music.hide()}})};MI.TalkBox.prototype._send=function(){var a=this,b,c=1,e=UI.trim(a._txt.value.replace(RegExp(a.txtTopic,"g"),"").replace(/＠/g,"@").replace(/＃/g,"#")),h,i,k,p;a.tmpl||MI.app({Tmpl:function(){a.tmpl=MI.tmpl.listAll}});if(!UI.hasClass(a._btn,"btnNoStr"))if(a._btn.disable||UI.hasClass(a._btn,"btnNoStr"))0==a.length&&a.showTip(a.txtTip.empty,1),a._txt.focus(),a._msgTo&&""==UI.trim(a._msgTo.value)&&a._msgTo.focus(),a.sending=0,a.flashTip();else if(a._btn.disable=1,UI.addClass(a._btn,"btnNoStr"),!a.type&&!a.pic&&!a.sourcePic&&!a.topic&&e.match(/^@[a-zA-Z]{1}[\w|-]{0,19}$/g))MI.Bos("btnAtAccountOnly"),MI.user.fun.gotoNanoUserProfile?a.goUser("http://1.t.qq.com/"+e.slice(1)):a.goUser("http://t.qq.com/"+e.slice(1)+"?from=1"),a.reset();else{a.delay.tip=setTimeout(function(){a.showTip(a.txtTipSend,2)},500);a.start&&a.start();b={content:e,startTime:a.startTime,endTime:(new Date).getTime(),countType:a.countType,viewModel:a.iconPic||""};a.code&&(b.veriCode=a.code);a.emotion&&(b.emotion=a.emotion);a.pass&&(b.pass=a.pass);a.type&&(b.pId=a.talkId,b.type=a.type);a._msgTo&&(b.account=a._msgTo.value.replace(/^@/,""));a.sourcePic?b.sourcepic=a.sourcePic:b.pic=a.pic;a.longText&&(b.longText=a.longText);a.topic&&(b.content=(b.content.match(RegExp(MI.string.escapeReg(a.topic)))?"":a.topic)+b.content);a.music&&a.music.id?(b.musicID=a.music.id,b.musicSong=a.music.song,b.musicSinger=a.music.singer,b.musicLocation=a.music.songurl,b.musicShortUrl=a.music.shorturl,a.music.songtype&&(b.musicSource=a.music.songtype)):a.mlist&&(b.mlistUin=a.mlist.uin,b.mlistName=a.mlist.name,b.mlistCnt=a.mlist.num,b.mlistUrl=a.mlist.url,b.mlistPic=a.mlist.pic);a.file&&a.file.uriId&&(b.fileUriId=a.file.uriId,b.fileName=a.file.name,b.fileValidTime=a.file.validTime,b.fileFlag=a.file.flag);a.video&&(b.video=a.video);a.vid&&(b.vid=a.vid);a.vote&&(b.vote=a.vote);a.addCheck&&!b.content.toLocaleLowerCase().hasString(a.addCheck.toLocaleLowerCase())&&(c=0);a.source&&(b.source=a.source);a.apiType?b.apiType=a.apiType:MI.api.type&&(b.apiType=a.apiType=MI.api.type);a.rmsg&&(b.rmsgType=a.rmsg.type,b.rmsgId=a.rmsg.id);if(a.data)for(var l in a.data)b[l]=a.data[l];a.emotion&&b.wqid&&delete b.wqid;UI.parseUrl().pref&&(b.pgv_ref=UI.parseUrl().pref);h=+new Date;MI.ajax({url:a.url,data:b,success:function(f){i=+new Date-h;clearTimeout(a.delay.timeout);f=MI.json(f);if(MI.user&&0==f.result&&f.info&&UI.isObject(f.info)){var j=f.info.talk[0],l=MI.user;j.pic=l.pic;j.nick=j.nick||l.name;j.name=j.name||l.account;4!=a.type&&(j.chName=j.chName||l.chName);j.flag=j.flag&&UI.isArray(j.flag)?l.flag:j.flag;f.info.iconPic=a.iconPic;f.info.guest=0;f.info.fav=0;f.info.shield=0;UI.hasClass(a._sendCnt,"hasMedia")&&UI.removeClass(a._sendCnt,"hasMedia")}if(MI.code.check(f.result))MI.code.show({msg:f.msg,code:f.info,call:function(b){a.code=b;a.send()}}),a.reset();else if(-104==f.result)MI.Bos("btnAtAccountOnlyCN"),f.info&&(MI.user.fun.gotoNanoUserProfile?a.goUser("http://1.t.qq.com/"+f.info):a.goUser("http://t.qq.com/"+f.info+"?from=1"),a.reset());else if(-103==f.result){var g=[];UI.isArray(f.info)&&UI.each(f.info,function(a){UI.isString(a)&&g.push(a.slice(1))});MI.app({Base:function(){MI.confirm({title:_("确定继续发送？"),content:_("你在广播中@到了{0}，可能忘了添加空格，因此未成功@到正确账号。","“"+g.join("”、“")+"”"),confirmTxt:_("继续发送"),confirm:function(){MI.dialog.hide();a.pass=f.result;a.send();MI.Bos("btnSendAtConfirm");a.emotion&&MI.Mood.floatBox.show();a.QX&&MI.Gift&&MI.Gift.buildTalk()},cancelTxt:_("返回修改"),cancel:function(){a.emotion&&MI.Mood.floatBox.show();a.QX&&MI.Gift&&MI.Gift.buildTalk();if(UI.isArray(f.info)&&UI.isString(f.info[0])){var b=a._txt.value.indexOf(f.info[0]);-1!=b?(b+=f.info[0].length,MI.selectTxt(a._txt,b,b,b)):a.focus()}MI.Bos("btnSendAtCancel")}});a.reset()}})}else if(-206==f.result||-207==f.result||-208==f.result){var g=[],m=[];UI.isArray(f.info)&&(UI.each(f.info,function(a){g.push(a);m.push(_("“")+a+_("”"))}),m.join(_("、")));switch(f.result){case -206:m=_("您在广播中@*到群{0}，可能输入有误，这个群不存在，请返回修改。",m);break;case -207:m=_('您在广播中@*到群{0}，您还不是这个群的成员，请<a href="http://qun.t.qq.com/'+g[0]+'" target="_blank">点击这里</a>先加入这个群，或者返回修改。',m);break;case -208:m=_("不能从私密群转发消息，这条广播将不会被转发。")}MI.app({Base:function(){MI.confirm({title:_("确定继续发送？"),content:m,confirmTxt:_("继续发送"),confirm:function(){MI.dialog.hide();a.pass=f.result;a.send();MI.Bos("btnSendAtConfirm");a.emotion&&MI.Mood.floatBox.show();a.QX&&MI.Gift&&MI.Gift.buildTalk()},cancelTxt:_("返回修改"),cancel:function(){a.emotion&&MI.Mood.floatBox.show();a.QX&&MI.Gift&&MI.Gift.buildTalk();if(UI.isArray(f.info)&&UI.isString(f.info[0])){var b=a._txt.value.indexOf(f.info[0]);-1!=b?(b+=f.info[0].length,MI.selectTxt(a._txt,b,b,b)):a.focus()}MI.Bos("btnSendAtCancel")}});a.reset()}})}else if(-22==f.result)MI.confirm({type:"error",width:250,title:_("请完成身份验证"),content:_("体验期间不能发表内容哦，</br>只有完成身份验证后才能发表微博。"),confirmTxt:_("进行身份验证"),cancelTxt:_("取消"),confirm:function(){MI.Bos("btnSendAtAccessVerify");document.location.href="http://t.qq.com/reg/confirm.php?s&t"},cancel:function(){MI.Bos("btnSendAtCancelVerify");a._tip.innerHTML=""}}),a.reset();else if(-23==f.result){if(clearTimeout(a.delay.tip),a._tip.innerHTML="<span>"+_("已被禁言")+'，<a class="gotoAsk" href="###">'+_("立即申诉")+">></a></span>",j=d(a._tip,".gotoAsk")[0])j.onclick=function(){MI.ajax({url:"http://api.t.qq.com/asyn/complain.php",success:function(b){MI.json(b);alert(_("你的申诉已经提交，请耐心等待"));a._tip.innerHTML=""}})},j=null}else clearTimeout(a.delay.tip),a.showTip(f.msg||"",0>f.result?1:0),a.flashTip(),0==f.result&&a._tipBig&&(d(a._tipBig,".msg")[0].innerHTML=f.msg,4!=a.type&&UI.addClass(a._body,"pubSuc"),UI.show(a._tipBig)),a.delay.tip=setTimeout(function(){UI.animate(a._tip,"opacity",1,function(){0==f.result&&(a._txt.value="");try{"none"!=a._body.style.display&&a._txt.focus()}catch(b){}a.countTxt();if(a._msgTo&&-9<f.result&&-5>f.result)try{a._msgTo.select()}catch(c){}UI.C(a._tip,"opacity","");a._tip.style.filter="";a.sending=0;UI.removeClass(a._btn,"btnNoStr");0==f.result&&(a.delPic(),a.delVideo(),a.delMusic(),a.rmsg=null,a.vote=null,a.code=null,a.pass=null,MI.Music&&MI.Music.builded&&MI.Music.clear(),a._guide&&a.guideReset());a.success&&0==f.result&&(a.success(f),UI.hide(a._tipBig))})},0==f.result?a.delayTime:a.delayTime+1E3);a.successStart&&0==f.result&&a.successStart(f);a.failStart&&0!=f.result&&a.failStart(f);var q=MI.talkList;a.data.wqid&&MI.talkListHot&&(q=MI.talkListHot);if(q&&a.addList&&0==f.result&&c){q._tip&&UI.hide(q._tip);q.add.push(f.info.talk[0].id);f.info.type=q.type;var r=UI.html((new UI.tmplString(a.tmpl))(f.info))[0];q.addEvent(r);UI.addClass(r,"newMsg");a.type||(UI.addClass(r,"fill-back"),setTimeout(function(){UI.removeClass(r,"fill-back")},3E4));UI.prepend(r,q._body);q.addFollowBtn(r);q._news.push(r);q.news++;var t=UI.height(r);UI.scrollY();UI.C(r,"height",0);setTimeout(function(){UI.animate(r,"height",t-22,function(){UI.C(r,"height","");q.bottom();MI.Crs(1)},0.3)},0)}if(0==f.result){a.startTime=0;a.autoSave&&MI.isS&&(j="draft_pic_"+MI.user.account,MI.S("draft_"+MI.user.account,""),MI.S(j,""));MI.isS&&!a.type&&MI.app({TalkBoxRich:function(){a.cacheTopic(b.content)}});try{MI.Group&&MI.Group.qid&&MI.talkList&&2===MI.talkList.type&&5===a.type&&a.countNum(1)}catch(u){}4!=a.type&&5!=a.type&&(!MI.Group||!MI.Group.qid||7!==a.type&&2!==a.type)&&a.countNum(1);MI.talkList&&f.info.talk[0].timestamp&&MI.talkList.updateTime(f.info.talk[0].timestamp);MI.talkListHot&&f.info.talk[0].timestamp&&MI.talkListHot.updateTime(f.info.talk[0].timestamp);a.txtCache=e}k=+new Date-h;setTimeout(function(){p=+new Date-h;MI.Speed("t_asyn_talk",0.1,i,k,p)},0)}});a.delay.timeout=setTimeout(function(){a.showTip(a.txtTip.fail,1);a._btn.disable=0;UI.removeClass(a._btn,"btnNoStr");MI.Bos("btnSendTimeout")},2E4)}};MI.TalkBox.prototype.delPic=function(){this._pic&&this.upPic&&(this.pic=this.sourcePic="",this.upPic._picForm.reset(),UI.hide(this._picPreview),UI.hide(this._picLoading),this._txt.value==this.txtPic&&(this._txt.value=""),this.txtSummary&&(this._txt.value=this._txt.value.replace(this.txtSummary,""),this.txtSummary=""),this.longText="",MI.Capture&&MI.Capture.uploader&&MI.Capture.uploader.StopUpload(),UI.B.chrome&&(this.upPic._picForm.innerHTML=this.upPic._picForm.innerHTML,this.upPic._picBtn=UI.GT(this.upPic._picForm,"input")[0],this.upPic._picBtn.onchange=this.upPic.picChange),this.countTxt(),UI.removeClass(this._picAnchor,"disabled"),2>UI.children(this._sendStatus,"sendThumbs").length&&UI.removeClass(this._sendCnt,"hasMedia"));if(this.autoSave)try{MI.S("draft_pic_"+MI.user.account,"")}catch(a){}};MI.TalkBox.prototype.delVideo=function(){this._video&&(this.video="",UI.remove(this._videoPreview),UI.removeClass(this._videoAnchor,"disabled"),2>UI.children(this._sendStatus,"sendThumbs").length&&"none"==this._picPreview.style.display&&UI.removeClass(this._sendCnt,"hasMedia"),this._txt.value==this.txtVideo&&(this._txt.value=""),this.countTxt())};MI.TalkBox.prototype.delMusic=function(){this.mlist=this.music="";this._music&&this.upMusic&&(UI.remove(this._musicPreview),UI.hide(this.upMusic._musicBox),UI.removeClass(this._musicAnchor,"disabled"),this._recordAnchor&&UI.removeClass(this._recordAnchor,"disabled"),this._txt.value.hasString(this.txtMusic)&&(this._txt.value=this._txt.value.replace(this.txtMusic,"")),this.countTxt())};MI.TalkBox.prototype.cancelPic=function(){this._pic&&this.upPic&&(this.pic="",UI.hide(this._picLoading),this.upPic._iframe.src="about:blank",this.upPic._picForm.reset(),UI.removeClass(this._picAnchor,"disabled"),this.upPic._picCapture[1]&&UI.removeClass(this.upPic._picCapture[1],"loading"),2>UI.children(this._sendStatus,"sendThumbs").length&&UI.removeClass(this._sendCnt,"hasMedia"))};MI.TalkBox.prototype._addPic=function(a){var b=this,c,e,h,i,k,p,l;if(b.upPic){i=b.upPic.PicUpTime;k=+new Date;UI.hide(b._picLoading);if(0==a.result){if(b.upPic.flashCapture){MI.PhotoMultiUpload.captureImg(a.info.image+"/2000");UI.removeClass(b.upPic._picCapture[1],"loading");return}!UI.hasClass(b._sendCnt,"hasMedia")&&UI.addClass(b._sendCnt,"hasMedia");h=a.info.host;c=a.info.image;(e=c.hasString("mblogpic.store.qq.com/mblogpic")||c.hasString("qpic.cn"))?b.pic=c:b.sourcePic=c;MI.PicTurn&&(MI.PicTurn.url="http://"+(h?h:"upload.t.qq.com"));MI.user.fun.turnPic&&a.info.path&&MI.PicTurn.reset(b.pic,a.info.path);var f=MI.user.fun.turnPic&&a.info.path;e=a.info.fileName||b.upPic._picBtn.value;h=e.substring(e.lastIndexOf(".")+1,e.length);e=e.match(/[^\/|\\]*$/)[0].replace(RegExp(h+"$"),"");e=MI.string.cut(e,10)+h;f?(b._picLink.innerHTML='<em class="sico ico_pic"></em><a href="'+c+'/2000" class="fileName" target="_blank">'+e+"</a>",UI.addClass(b._picAnchor,"disabled")):(UI.append(b._uploadPicS,b._sendStatus),UI.addClass(b._picAnchor,"disabled"),b._picLink.innerHTML='<em class="sico ico_pic"></em><a href="'+c+'/2000" class="fileName" target="_blank" style="position:relative;">'+e+'<span class="simg" style="cursor:default;"><img  src="'+c+'/160" /><br /><span style="white-space:nowrap;display:'+(UI.B.ipad?"none":"inline")+'"><span class="useFilter" style="cursor:pointer;display:inline-block;padding:5px 0;" href="javascript:void(0)">'+_("魔法滤镜")+"</span></span></span></a>",d(b._picLink,".useFilter")[0].onclick=function(){MI.app({Base:function(){var a=c.replace("mblogpic.store.qq.com/mblogpic","t0.qpic.cn/mblogpic");MI.photoFilter.build(a+"/2000","http://api.t.qq.com/asyn/updateGrabPic.php");MI.TalkBox.cur=b}});MI.Bos("btnPhotoFilter");return!1});var j=d(b._picLink,".fileName")[0],o;h=function(){f?MI.PicTurn.show():(clearTimeout(o),clearTimeout(MI.PicTurn.autoHideDelay),UI.addClass(j,"hover"))};var g=function(){f?MI.PicTurn.hideT():o=setTimeout(function(){UI.removeClass(j,"hover")},200)};UI.EA(j,"mouseover",h);UI.EA(j,"mouseout",g);h();MI.PicTurn.autoHideDelay=setTimeout(g,3E3);UI.show(b._picPreview);b.guideTextRemove();""==b._txt.value&&e!=_("表情.jpg")&&(b._txt.value=b.txtPic,b.countTxt());b.focus()}else b.cancelPic(),MI.alert(a.msg);b.upPic._picForm.reset();i&&(p=+new Date-i,setTimeout(function(){l=+new Date-i;MI.Speed("t_asyn_uploadpic",1,k,p,l)},0));b.upPic.PicUpTime=null;if(b.autoSave&&a)try{a.info.fileName=e,MI.S("draft_pic_"+MI.user.account,UI.json2str(a))}catch(m){}}else setTimeout(function(){b.picUploadBuild&&b.picUploadBuild();b.addPic(a)},100)};MI.TalkBox.prototype._getVideo=function(a){var b=this,c=b.upVideo;b.ayncVideoResult=null;UI.trim(a)&&(this.delayVideo&&clearTimeout(this.delayVideo),this.delayVideo=window.setTimeout(function(){c&&(c._videoError.innerHTML=c._errMsg[1],UI.show(c._videoError));MI.ajax({url:MI.url.validateVideo,type:"get",data:"url="+encodeURIComponent(a)+"&r="+MI.random(),success:function(a){c&&(c._videoBtn.disabled=!1);a=MI.json(a);b.ayncVideoResult=a.result;if(0==a.result){if(c&&UI.hide(c._videoError),a.url){clearTimeout(b.delayVideoTime);var h=a.title.replace(/\&lt;/g,"<").replace(/\&gt;/g,">").replace(/\&quot;/g,'"'),i=_("#分享视频#")+h+" http://url.cn/"+a.url+" ";b.video=a.url;b.txtVideo=i;c&&(b.addTopic(i),c._videoTxt.value="");b.countTxt();b.focus();i='<div class="sendThumbs uploadVideo"><span class="preview"><span class="link"><em class="sico ico_videos"></em><a class="fileName" href="#">%title%<span class="vThumbs"><span class="mask"><em></em></span><img src="%pic%" /></span></a></span><a class="del" href="#" title="'+_("删除")+'">['+_("删除")+"]</a></span></div>";a.pic=a.pic?a.pic:"http://mat1.gtimg.com/www/mb/images/vNoThumbs.jpg";a=i.replace(/\%title\%/g,MI.string.cut(MI.string.html(h),10)).replace(/\%pic\%/g,a.pic);b._videoPreview=UI.html(a)[0];UI.append(b._videoPreview,b._sendStatus);UI.addClass(this,"disabled");!UI.hasClass(b._sendCnt,"hasMedia")&&UI.addClass(b._sendCnt,"hasMedia");a=d(b._videoPreview,".del")[0];a.onclick=function(a){UI.E(a).stop();b.delVideo();return!1};a=null;UI.addClass(b._videoAnchor,"disabled");c&&c.hide()}}else-1==a.result?c&&(c._videoError.innerHTML=c._errMsg[0],UI.show(c._videoError)):-3==a.result?c&&(c._videoError.innerHTML=c._errMsg[3],UI.show(c._videoError),b._videoNormalBtn=d(c._box,".vNormalBtn")[0],b._videoNormalBtn.onclick=function(){UI.trim(c._videoTxt.value)&&(b._txt.value+=UI.trim(c._videoTxt.value),c._videoTxt.value="",clearTimeout(b.delayVideoTime),c.hide());return!1}):c&&(c._videoError.innerHTML=c._errMsg[2],UI.show(c._videoError))}});c&&(b.delayVideoTime=setTimeout(function(){!b.ayncVideoResult&&c&&(c._videoError.innerHTML=c._errMsg[2],UI.show(c._videoError))},2E4))},200))};MI.TalkBox.prototype.uploadCollection=function(a){var b=this,c=a.name,e=a.tab,h=a.cnt,i=a.query,k=a.className,p=a.flashTab||[],l=a.buildEvent,f=a.tabEvent,j=a.showEvent,o=a.hideEvent,a=a._open,g=b["up"+c]={},m='<div class="D3 '+k+'" style="display:none"><div class="tabStyle3"><ul>';UI.each(e,function(a){m+='<li><a href="javascript:void(0)">'+a+"</a></li>"});m+='</ul><a class="close" href="#" title="'+_("关闭")+'"></a></div>';m+=h;m+='<div class="SA"><em>◆</em><span>◆</span></div></div>';g._box=UI.html(m)[0];g._open=a;g._tab=d(g._box,".tabStyle3 li");g._div=d(g._box,i);g._close=d(g._box,".tabStyle3 .close")[0];g._arrows=d(g._box,".SA")[0];UI.after(g._box,b._sendStatus);(UI.B.ipad||MI.user.fun.qbUpload||b.noFlash)&&UI.each(p,function(a){UI.hide(g._tab[a])});g.switchTab=function(a){UI.hasClass(this,"select")||(UI.each(g._div,function(b,c){a==c?(UI.addClass(g._tab[c],"select"),UI.removeClass(g._div[c],"hideDcnt")):(UI.removeClass(g._tab[c],"select"),UI.addClass(g._div[c],"hideDcnt"))}),f&&MI.app({Base:function(){f(g,a)}}))};UI.each(g._tab,function(a,b){a.onclick=function(){g.switchTab(b)}});g.hide=function(){"none"!=g._box.style.display&&(o&&o(g),UI.hide(g._box))};g.setArrPos=function(a){if(a){var b=g.arrPos||UI.getX(a)+UI.width(a)/2-UI.getX(g._box.parentNode);UI.text(a)||(b-=7);g._arrows.style.left=b+"px";return b}};g.show=function(a){MI.TalkBox.cur=b;if("none"!=g._box.style.display)return!1;b.hideMedia();if(UI.hasClass(g._open,"disabled"))return!1;UI.show(g._box);j&&j(g);g.switchTab(a||0);g._open.blur();MI.Bos("btn"+c);g.setArrPos(g._open);g.showed=1;return!1};g._close.onclick=function(){g.hide();return!1};g._open.onclick=function(){g.show(0);return!1};l&&l(g)};MI.TalkBox.prototype.addEvent=function(){var a=this;if(!a.addEvented){a._insertFun=a.$(".insertFun");a._topic=a.$(".creatNew");a._topicNewYear=a.$(".atWen .txt");a._at=a.$(".atSome");a._face=a.$(".insertFace .txt,a.ico_face");a._mood=a.$(".newFeel .txt");a._vote=a.$(".newVote .txt");a._order=a.$(".newOrder .txt");a._gift=a.$(".newGift .txt");a._file=a.$(".uploadFile .txt");a._video=a.$(".uploadVideo");a._videoAnchor=d(a._video,".txt")[0];a._music=a.$(".uploadMusic");a._musicAnchor=d(a._music,".txt")[0];a._record=a.$(".record");a._record&&(a._recordAnchor=d(a._record,".txt")[0]);a._pic=a.$(".uploadPic");a._picAnchor=d(a._pic,".txt")[0];a._syncQzoneUnite=a.$(".synchFrm .txt");a._syncQzone=a.$(".replayQzoneCheckbox");a._more=a.$(".smoreFun");a._moreBox=d(a._more,".moreBox")[0];a._moreAnchor=d(a._more,".more")[0];a._moreDropBox=d(a._more,".dropBox")[0];a._sendCnt=a.$(".sendCnt");a._autoBackspace=a.$(".autoBackspace");a._sendStatus=a.$(".sendStatus")||UI.DC("div");var b=function(){a.sending||a.countTxt()},c=function(c){var e=UI.E(c);if(!a.startTime&&c&&(c=e.type,"input"==c||"paste"==c||"cut"==c||c.hasString("key")))a.startTime=+new Date,MI.ajax({url:MI.url.notice,type:"get",data:"op=1"});clearTimeout(a.delay.count);e.target==a._txt&&a.guideTextRemove();a.delay.count=setTimeout(b,75)};UI.EA(a._txt,"keypress",c);UI.EA(a._txt,"input",c);UI.EA(a._txt,"paste",c);UI.EA(a._txt,"cut",c);a._txt.onbeforeeditfocus=c;a._body.onkeydown=function(b){a.sending||(b=UI.E(b),b.ctrl&&13==b.key?(a.sending=1,c(),a.send(),MI.Bos("btnCtrlEnter")):a._pic&&86==b.key&&b.ctrl&&(a.installCapturePluginTip||(a.tmpTxt=a._txt.value),MI.app({Capture:function(){MI.Capture&&MI.Capture.uploader&&(!a.upPic&&a.picUploadBuild&&a.picUploadBuild(),MI.Capture.upload())}})))};a._body.onkeyup=function(b){b=UI.E(b);a.sending||c();if(!(a.installCapturePluginTip||b.target!=a._txt)&&a._pic&&b.ctrl&&86==b.key&&a.tmpTxt==a._txt.value)MI.app({Capture:function(){(!MI.Capture||!MI.Capture.enable)&&MI.confirm({title:_("你想直接粘贴图片吗？"),content:_("安装截屏插件，就可以在输入框中粘贴图片并随时截屏"),confirmTxt:_("安装"),confirm:function(){MI.Capture.install()}})}}),a.installCapturePluginTip=1};MI.user.fun.relTopic&&a._sendCnt&&UI.EA(a._txt,"keyup",function(b){if(!a.noRelTopic){clearTimeout(a.relTopicDelay);var c=a._txt.value,b=8!=UI.E(b).key?1E3:250;20>MI.string.length(c)?a.upRelTopic&&a.upRelTopic.hide():a.relTopicDelay=setTimeout(function(){c==a._txt.value&&MI.app({TalkBoxRich:function(){try{a.showRelTip()}catch(b){}}})},b)}});UI.hasClass(a._txt,"noAutoCmt")||setTimeout(function(){MI.app({Base:function(){a.autoCmt=new MI.AutoCmt({target:a._txt,key:1,topic:1,face:1,tips:a.tips?a.tips:1,call:function(){c()}})}})},50);a._topic&&(a._topic.onclick=function(){a.guideTextRemove(1);var b=MI.getSelectTxt(a._txt);if(a._txt.value&&b.txt&&b.txt!=a.txtTopic.replace(/#/g,""))return MI.selectTxt(a._txt,b.start,b.start),MI.insertTxt(a._txt,"#",b.start),MI.selectTxt(a._txt,b.end+1,b.end+1),MI.insertTxt(a._txt,"#",b.end+1),MI.selectTxt(a._txt,b.start+1,b.end+1),a.countTxt(),MI.Bos("btnTopic"),!1;a.addTopic();MI.Bos("btnTopic");return!1});a._more&&(a._moreAnchor.onclick=function(){UI.addClass(a._moreBox,"sopen");return!1},a._moreBox.onmouseover=function(){clearTimeout(a.delay.moreBox)},a._moreBox.onmouseout=function(){a.delay.moreBox=setTimeout(function(){UI.removeClass(a._moreBox,"sopen")},200)});a._topicNewYear&&(a._topicNewYear.onclick=function(){var b="",c=UI.A(this,"user"),e="#"+(UI.A(this,"topic")||_("微博拜年"))+"#",d=a._txt.value;d.hasString(e)||(b+=e);"@"!=d.slice(MI.cursorX(a._txt)-1)&&!c&&(b+="@");c&&!d.hasString(c)&&(b+="@"+c+" ");b?a.addTopic(b):MI.focus(a._txt);a._moreBox&&UI.removeClass(a._moreBox,"sopen");MI.Bos("btnTopicNewYear");return!1});a._at&&(a._at.onclick=function(){var b=this;a.hideMedia();setTimeout(function(){a.autoCmt&&a.autoCmt.showAll(b)},0);MI.TalkBox.cur=a;MI.Bos("btnAt",0,0.01);return!1});a._face&&(a._face.onclick=function(){a.hideMedia();MI.app({TalkBoxRich:function(){a.addFace()}});MI.Bos("btnFace",(a.type||1)+"");return!1});if(a._mood){var e=d(a._mood,".ico_feel")[0];MI.user.fun.feelTip&&a.feelTip&&(UI.A(a._mood,"title",_("跳动的小心脏提醒你记录每日心情")),e.innerHTML='<img src="http://mat1.gtimg.com/www/mb/images/feel.gif" alt="">');a._mood.onclick=function(){MI.user.fun.feelTip&&""!=e.innerHTML&&(UI.A(a._mood,"title",_("心情")),e.innerHTML="",MI.Bos("btnMoodClickFlick"));MI.app({Mood:function(){MI.Mood.floatBox.show()}});MI.Bos(UI.A(this,"sign")?"btnMoodTalkBoxLook":"btnMoodTalkBoxWrite");return!1};setTimeout(function(){""!=e.innerHTML&&(UI.A(a._mood,"title",_("心情")),e.innerHTML="")},15E3)}a._syncQzoneUnite||a._syncQzone?(a._syncQzoneUnite&&(a._sico=d(a._syncQzoneUnite,".sico")[0],a.toogleSyncQzone=function(b){a._sico.className=b?"sico ico_diary":"sico ico_diary_gray";a._syncQzoneUnite.title=b?_("已同步至QQ空间"):_("未同步至QQ空间");a.data.syncQzone=1*b},a._syncQzoneUnite.onclick=function(){MI.ajax({type:"get",url:MI.url.syncQzoneSet,data:{ss:1*!MI.user.fun.syncQzone,t:2},success:function(b){b=MI.json(b);0==b.result&&(MI.user.fun.syncQzone=1*!MI.user.fun.syncQzone,a.toogleSyncQzone(1*MI.user.fun.syncQzone))}});MI.Bos("btnSyncQzoneUnite");return!1},a.toogleSyncQzone(1*!!MI.user.fun.syncQzone)),a._syncQzone&&(a.syncQzoneOld?(a.data.share=1*a._syncQzone.checked,a.data.syncQzone=0):(a.data.syncQzone=1*a._syncQzone.checked,a.data.share=0),a._syncQzone.onclick=function(){a.syncQzoneOld?(a.data.share=1*this.checked,MI.Bos("btnShareQzoneCheckBox")):(a.data.syncQzone=1*this.checked,MI.Bos("btnSyncQzoneCheckBox"))})):a.data.syncQzone=0;a._gift&&(a._gift.onclick=function(){var a=UI.A(this,"eventId");MI.sendGiftShow(1*a);MI.Bos("btnTalkBoxSendGift"+a);return!1});a._vote&&(a._vote.onclick=function(){a.addVote();a._moreBox&&UI.removeClass(a._moreBox,"sopen");MI.Bos("btnVote");return!1});if(MI.user.fun.relTopic){var h='<div class="relTopicBox" style="width:290px;">          \t<ul class="relTopicList"></ul>            <div class="cNote">'+_("你的广播内容可能与以上话题相关")+"</div>          </div>";a.showRelTip=function(){a.upRelTopic||a.uploadCollection({type:null,name:"RelTopic",tab:[_("加入话题可获得更多关注和互动")],cnt:h,query:".relTopicBox",className:"relTopic",flashTab:[],_open:UI.DC("div"),buildEvent:function(b){b._relTopicList=d(b._box,".relTopicList")[0];b._tips=d(b._box,".cNote")[0];b.added=[];b.arrPos="-999";b.topicReg=/(#\s*[^#\s]{1}[^#]{0,59}?\s*#)/;UI.GT(b._tab[0],"a")[0].style.cssText="cursor:default;text-decoration:none";UI.C(b._box,"width","340px");b._close.onclick=function(){b.hide();"none"!=b._tips.style.display&&(b.notShowAgain=1);return!1};b.showResult=function(){b.hide();if(b.added.length){var a="<li>"+_("去");UI.each(b.added,function(b){a+='<a target="_blank" href="http://t.qq.com/k/'+b+'">#'+b+"#</a> "});a+=_("看看大家都在说什么吧")+"</li>";b._relTopicList.innerHTML=a;UI.hide(b._tips);UI.show(b._box);b.added=[]}b.notShowAgain=0};var c=a.success;a.success=UI.isFunction(c)?function(e){c.call(a,e);b.showResult()}:function(){b.showResult()}},showEvent:function(a){UI.show(a._tips)}});var b=a.upRelTopic;if(b.notShowAgain||b.topicReg.test(a._txt.value))return!1;MI.ajax({url:MI.url.relativeTopics,type:"post",data:{t:a._txt.value,r:MI.random()},success:function(c){c=MI.json(c);if(0==c.result&&c.info.s){var e="";UI.each(c.info.s,function(a){e+='<li><a href="javascript:void(0)">#'+a+"#</a></li>"});b._relTopicList.innerHTML=e;UI.each(UI.GT(b._relTopicList,"a"),function(c){c.onclick=function(){var e=c.innerHTML;a._txt.value.hasString(e)||(a._txt.value=e+" "+a._txt.value,b.added.push(e.replace(/#/g,"")),a.countTxt());b.hide();return!1}});b.show(0)}else b.hide()}});return!1}}a._file&&(a._file.onclick=function(){window.open("http://t.qq.com/uploadfile.php?qid=0","wbUploadFile","height=320,width=594,top="+(window.screen.availHeight-30-320)/2+",left="+(window.screen.availWidth-10-594)/2+",scrollbars=yes,resizable=yes");MI.Bos("btnUploadFile");return!1});if(a._order){var i='<div class="orderBox"><p>'+_("粘贴商品地址")+'</p><p class="clear"><input type="text" class="inputTxt"><button class="btn1">'+_("确定")+'</button></p><p class="cError" style="display:none"></p></div>';a._order.onclick=function(){a.uploadCollection({type:null,name:"Order",tab:[_("商品")],cnt:i,query:".orderBox",className:"insertOrder",flashTab:[],_open:a._order,buildEvent:function(b){var c=RegExp("((news|telnet|nttp|file|http|ftp|https)://){1}(([-A-Za-z0-9]+(\\.[-A-Za-z0-9]+)*(\\.[-A-Za-z]{2,5}))|([0-9]{1,3}(\\.[0-9]{1,3}){3}))(:[0-9]*)?(/[-A-Za-z0-9_\\$\\.\\+\\!\\*\\(\\),;:@&=\\?/~\\#\\%]*)*","i"),e=[_("你输入的商品链接已提交，请等待"),_("商品地址不能为空，请在输入框粘贴或输入"),_("不支持该地址，请重新输入")];b._inputTxt=d(b._box,".inputTxt")[0];b._submit=d(b._box,".btn1")[0];b._tip=d(b._box,".cError")[0];b._submit.onclick=function(){var d=UI.trim(b._inputTxt.value);c.test(d)?(b._submit.disabled=!0,b._tip.innerHTML=e[0],UI.show(b._tip),MI.ajax({url:MI.url.uploadOrder,type:"post",data:{op:1,url:UI.utfEncode(d),r:MI.random()},success:function(c){c=MI.json(c);if(0==c.result&&c.info){var d=(c.info.topic||"")+(c.info.name||"");a._txt.value.hasString(d)||a.addTopic(d);b._tip.innerHTML=e[0];b.hide();a.rmsg={type:0,id:c.info.id}}else b._submit.disabled=!1,b._tip.innerHTML=c.msg}})):(b._inputTxt.focus(),b._tip.innerHTML=!d?e[1]:e[2],UI.show(b._tip))}},showEvent:function(a){a._inputTxt.value="";a._submit.disabled=!1;a._tip.innerHTML="";a._inputTxt.focus()}});a.upOrder.show(0);return!1}}if(a._music){var k='<div class="m_sResult rSearch"><div class="m_self"><a href="#">'+_("我要自己上传")+'<em class="ffsong">&gt;&gt;</em></a></div></div>\t  <div class="m_sResult rFav hideDcnt"></div>\t  <div class="m_sResult recordBox hideDcnt"></div>';a.musicUploadBuild=function(){if(!a.upMusic){var b=!MI.user.fun.newMusicBox?[_("上传音乐"),_("音乐收藏")]:[_("分享歌曲"),_("分享歌单")];"en_US"!=window.MILang&&MI.user.fun.audioRecord&&(b[2]=a.recordTabName||_("我要录音"));a.uploadCollection({type:2,name:"Music",tab:b,cnt:k,query:".m_sResult",className:"insertMusic",flashTab:"en_US"==window.MILang?[]:[2],_open:a._musicAnchor,buildEvent:function(b){if(!d(a._sendStatus,".uploadMusic")[0])if(MI.Music){if(!MI.Music.builded||!a.MusicBuild)MI.Music.build(a),a.MusicBuild=1;MI.Music.show()}else MI.app({Music:function(){MI.Music&&(MI.Music.build(a),MI.Music.show())}});b._audioUpload=d(b._box,".m_self")[0];if(!MI.user.fun.audioUpload)return UI.hide(b._audioUpload),UI.hide(b._tab[2]),!1;b._audioUpload&&(b._audioUpload.onclick=function(){b.hide();a.audioUpload();return!1})},showEvent:function(){MI.Music&&MI.Music.talkBoxList&&UI.each(MI.Music.talkBoxList,function(b){b==a?MI.Music.talkBox=a:b.upMusic.hide()})},hideEvent:function(b){clearTimeout(a.delayMusicTime);b._div[2].innerHTML="";MI.Music&&MI.Music.stop()},tabEvent:function(a,b){2==b&&(MI.Flash&&9>MI.Flash.getVersion()?a._div[2].innerHTML=MI.Flash.updateTip(9):""==a._div[2].innerHTML&&(a._div[2].innerHTML=MI.user.fun.audioRecord?'<div class="flashWrap">'+MI.Flash.getObject(null,MI.swf.MusicRecord,404,160,"musicRecord")+"</div>":""))}})}};a._musicAnchor.onclick=function(){a.musicUploadBuild();a.upMusic.show(0);UI.EA(a._musicAnchor,"click",function(){a.upMusic.setArrPos(a._musicAnchor);UI.show(a.upMusic._tab[0]);UI.show(a.upMusic._tab[1]);a.upMusic.switchTab(0)});return!1};a._recordAnchor&&(a._recordAnchor.onclick=function(){UI.fireEvent(a._musicAnchor,"click");a.upMusic.setArrPos(a._recordAnchor);UI.hide(a.upMusic._tab[0]);UI.hide(a.upMusic._tab[1]);a.upMusic.switchTab(2);return!1});window.getMicRecUploadResult=function(b,c,e){0==b&&(UI.A(a.upMusic._tab[2],"music","0,"+c+","+MI.user.account+","+_("录音")),MI.Music.addPreview(a.upMusic._tab[2],"",1),a.upMusic.hide(),a.music.songtype=3,a.music.shorturl=e,a.txtMusic=_("来，听听我的声音。")+" http://url.cn/"+e+" ",a._txt.value=a._txt.value!=a.txtMusic?a._txt.value+a.txtMusic:a.txtMusic,a.countTxt(),a.focus())};window.getRecDuration=function(){var a=[60,40,50,15];2==MI.TalkBox.prototype.data.cflag&&(a=[180,120,170,17]);return a}}if(a._video){var p='<div class="videoWrap urlVideo"><form method="get" class="videoUploadFrom" id="videoUploadFrom" name="videoUploadFrom"><p>'+_("粘贴视频播放页地址")+'<br><span class="cNote">('+_("支持腾讯视频、优酷、土豆、酷六、CNTV")+')</span></p><p class="clear"><input type="text" class="inputTxt"><input type="button" value="'+_("确定")+'" class="btn1"></p><p class="cError" style="display: none; "><a href="#" class="vNormalBtn"></a></p><p><a class="videoUpload ulink" href="#">'+_("我要自己上传视频")+'<em class="ffsong">&gt;&gt;</em></a></p></form></div>\t  \t<div class="videoWrap hideDcnt cameraVideo">\t<div class="flashWrap"></div><div class="maskLoading"></div></div>';a.videoUploadBuild=function(){a.uploadCollection({type:1,name:"Video",tab:!MI.user.fun.selfVideo?[_("视频链接")]:[_("视频链接"),_("拍摄视频")],cnt:p,query:".videoWrap",className:"insertVideo",flashTab:[1],_open:a._videoAnchor,buildEvent:function(b){b._videoForm=d(b._box,".videoUploadFrom")[0];b._videoTxt=d(b._box,".inputTxt")[0];b._videoBtn=d(b._box,".btn1")[0];b._videoError=d(b._box,".cError")[0];b._videoUpload=d(b._box,".videoUpload")[0];b._errMsg=[_("请先登录再进行操作"),_("稍等一下，喝杯茶，转贴的视频正在来的路上"),_("转贴的视频丢在路上了，再试一次？"),_("暂不支持该视频地址，")+'<a href="#" class="vNormalBtn">'+_("作为普通链接显示")+"</a>"];b._videoForm.onsubmit=function(){if(!UI.trim(b._videoTxt.value))return b._videoTxt.focus(),!1;a.getVideo(UI.trim(b._videoTxt.value));b._videoBtn.disabled=!0;return!1};b._videoBtn.onclick=function(){if(UI.trim(b._videoTxt.value))return a.getVideo(UI.trim(b._videoTxt.value)),this.disabled=!0,!1;b._videoTxt.focus()};b._videoUpload.onclick=function(){b.hide();var c=MI.url.uploadVideo,e=(window.screen.availHeight-30-320)/2,d=(window.screen.availWidth-10-594)/2;a.data&&a.data.wqid&&(c=c+"?qid="+a.data.wqid+"&zone="+a.data.cflag);window.open(c,"wbVideo","height=320,width=594,top="+e+",left="+d+",scrollbars=yes,resizable=yes");MI.Bos("btnVideoUpload");return!1}},showEvent:function(a){UI.hide(a._videoError);UI.trim(a._videoTxt.value)?a._videoTxt.select():a._videoTxt.focus()},tabEvent:function(b,c){if(1==c){var e=b._div[c],d=["","VideoRecord"][c],h=["","btnVideoRecord"][c];MI.app({TalkBoxRich:function(){MI[d].build(e,"#");MI.TalkBox.cur=a}});MI.Bos(h)}},hideEvent:function(){clearTimeout(a.delayVideoTime);MI.app({TalkBoxRich:function(){MI.VideoRecord&&MI.VideoRecord.clear()}})}})};a._videoAnchor.onclick=function(){a.videoUploadBuild();a.upVideo.show(0);return!1}}if(a._pic){var l="imageUpload_"+MI.random(),f=MI.url.uploadPic,j=MI.user.fun.qbUpload?' type="button" value="&nbsp;" ':' type="file" size="3"',s='<div class="sendThumbs uploadPicS"><span style="display:none" class="pidLoad loading">'+_("上传中")+'<a class="cancel" href="#">['+_("取消")+']</a></span><span style="display:none;" class="preview"><span class="link"><em class="sico ico_pic"></em></span><a href="#" class="del">['+_("删除")+']</a></span><iframe id="'+l+'" name="'+l+'" src="about:blank" style="display:none"></iframe></div>',g='<div class="picDiv singlePic">\t<p><form target="imageUpload" method="post" enctype="multipart/form-data" class="sPicForm"><a class="btn_addPic" href="javascript:void(0);"><span><em>+</em>'+_("添加图片")+'</span><input class="filePrew" name="pic"'+j+'title="'+_("支持jpg、jpeg、gif、png格式，文件小于5M")+'" tabindex="3"/></a></form></p>\t<p><a class="ulink capture" style="display:none;" href="#">'+_("直接截屏上传")+'</a></p></div><div class="picDiv hideDcnt multiPic"><p>'+_("按住Ctrl 键可一次选中并上传多张图片（最多8张），拖动图片可以调整顺序")+'</p><div class="flashWrap"></div><div class="clear"><p class="left"><a class="ulink capture" style="display:none;" href="#">'+_("直接截屏上传")+'</a></p><p class="right"><span class="error"></span><button class="btnSend btn1">'+_("确定")+'</button><button class="btnCancel btn1">'+_("取消")+'</button></p></div><div class="maskLoading"></div></div><div class="picDiv hideDcnt urlPic">\t<p>'+_("粘贴图片地址")+'<span class="cNote">('+_("可在广播中直接显示图片")+')</span></p>\t<form method="get" class="sourcepicFrom" name="sourcepicFrom"><p class="clear"><input type="text" class="inputTxt"><input type="submit" value="'+_("确定")+'" class="btn1"></p><p class="cError" style="display:none">'+_("图片地址不能为空，请在输入框粘贴或输入")+'</p></form></div><div class="picDiv hideDcnt Text2Pic">\t<p class="cNote">'+_("会自动帮你提取话题、@帐号、链接，2000字以内。")+'</p>\t<div class="txtCnt type1"><div class="tbg"></div><div class="cbg"><b style="display:none;width:0;overflow:hidden"></b><textarea class="inputArea  longText"></textarea></div><div class="fbg"></div><span class="tip"></span></div>\t<div class="flashWrap"></div>\t<div class="clear"><p class="typeSel"><a class="select" href="#"><img alt="" src="http://mat1.gtimg.com/www/mb/images/tp/tb/1.png"></a><a href="#"><img alt="" src="http://mat1.gtimg.com/www/mb/images/tp/tb/2.png"></a><a href="#"><img alt="" src="http://mat1.gtimg.com/www/mb/images/tp/tb/3.png"></a><a href="#"><img alt="" src="http://mat1.gtimg.com/www/mb/images/tp/tb/4.png"></a></p><p class="right"><button class="btn1 btnSend">'+_("确定")+'</button><button class="btn1 btnCancel">'+_("取消")+'</button></p><div class="maskLoading"></div><span class="tip"></span></div></div><div class="picDiv hideDcnt cameraPic">\t<div class="flashWrap"></div><div class="clear" style="display:none"><p class="left"><span class="tip"></span></p><p class="right"><button class="btnSend btn1">'+_("确定")+'</button><button class="btn1 btnCancel">'+_("取消")+'</button></p></div><div class="maskLoading"></div></div><div class="picDiv hideDcnt searchPic" style="height:208px"><div class="p_sResult"></div></div>';a._uploadPicS=UI.html(s)[0];a._picLoading=d(a._uploadPicS,".pidLoad")[0];a._picPreview=d(a._uploadPicS,".preview")[0];a._picLink=d(a._uploadPicS,".link")[0];UI.append(a._uploadPicS,a._sendStatus);MI.user.fun.turnPic&&(UI.append(MI.PicTurn.build(a),a._uploadPicS),f=MI.PicTurn.url+f);a.picUploadBuild=function(){a.uploadCollection({type:0,name:"Pic",tab:"en_US"==window.MILang?[_("本地上传"),_("多图"),_("链接"),_("文图"),_("拍照")]:[_("本地上传"),_("多图"),_("链接"),_("文图"),_("拍照"),_("搜图")],cnt:g,query:".picDiv",className:"insertPic",flashTab:[1,3,4],_open:a._picAnchor,buildEvent:function(b){b._picForm=d(b._box,".sPicForm")[0];b._iframe=o(l);b._picBtn=UI.GT(b._picForm,"input")[0];b._picDel=d(a._uploadPicS,".del")[0];b._picCancel=d(a._uploadPicS,".cancel")[0];b._picCapture=d(b._box,".capture");b._sourcepicBox=b._div[2];b._sourcepicTxt=d(b._sourcepicBox,".inputTxt")[0];b._sourcepicBtn=d(b._sourcepicBox,".btn1")[0];b._sourceError=d(b._sourcepicBox,".cError")[0];b._sourcepicFrom=d(b._sourcepicBox,".sourcepicFrom")[0];b._searchPicBox=b._div[5];a._searchPicBox=b._searchPicBox;(UI.B.ipad||MI.user.fun.qbUpload)&&UI.hide(b._picCapture[0]);!MI.user.fun.qbUpload&&!UI.B.ipad&&!UI.hasClass(document.body,"ipad")&&!a.pic&&(!a._picLoading||"none"==UI.C(a._picLoading,"display"))&&MI.TalkBox.captureEnable()&&UI.each(b._picCapture,function(a,c){UI.show(a);a.onclick=function(){MI.app({Capture:function(){MI.Capture&&MI.Capture.enable?(b.flashCapture=c,MI.Capture.screen.DoCapture()):MI.confirm({title:_("你还未安装腾讯微博截屏插件"),content:_("安装后，你就可以使用截屏功能"),confirmTxt:_("安装"),confirm:function(){MI.Capture.install()}})}});return!1}});b.resetSourcePic=function(){UI.hide(b._sourceError);b._sourcepicTxt.value="";b._sourceError.innerHTML="";b._sourcepicBtn.disabled=!1};b._sourcepicBtn.onclick=b._sourcepicFrom.onsubmit=function(){var c=RegExp("((news|telnet|nttp|file|http|ftp|https)://){1}(([-A-Za-z0-9]+(\\.[-A-Za-z0-9]+)*(\\.[-A-Za-z]{2,5}))|([0-9]{1,3}(\\.[0-9]{1,3}){3}))(:[0-9]*)?(/[-A-Za-z0-9_\\$\\.\\+\\!\\*\\(\\),;:@&=\\?/~\\#\\%]*)*","i"),e=[_("你输入的图片链接已提交，请等待"),_("图片地址不能为空，请在输入框粘贴或输入"),_("你输入的图片地址不是正确的URL格式，请重新输入")];b._sourcepicValue=UI.trim(b._sourcepicTxt.value);c.test(b._sourcepicValue)?(b._sourcepicBtn.disabled=!0,b._sourceError.innerHTML=e[0],UI.show(b._sourceError),MI.ajax({url:MI.url.uploadUrlPic,type:"get",data:"sourcepic="+encodeURIComponent(b._sourcepicValue)+"&r="+MI.random(),success:function(c){c=MI.json(c);0==c.result&&c.info?(b.hide(),a.addPic({result:0,msg:_("上传成功"),info:{image:c.info.image,fileName:_("链接.jpg")}}),!UI.hasClass(a._sendCnt,"hasMedia")&&UI.addClass(a._sendCnt,"hasMedia")):b._sourcepicBtn.disabled=!1;b._sourceError.innerHTML=c.msg}})):(b._sourcepicTxt.focus(),b._sourceError.innerHTML=!b._sourcepicValue?e[1]:e[2],UI.show(b._sourceError));MI.Bos("btnSourcePic");return!1};b._picForm.reset();MI.user.fun.qbUpload?(f="http://wbupload://t.qq.com/asyn/updateGrabPic.php?retType=1&cookiejs=MI.TalkBox.cur.qbUploadCookie&successjs=MI.TalkBox.cur.qbUploadAddPic&positionjs=MI.TalkBox.cur.qbUploadPosition",b._qbPicUploadBtn=d(b._picForm,"input")[0],b._picForm.removeAttribute("target"),b._qbPicUploadBtn.onclick=function(){b.PicUpTime=+new Date;b._picForm.submit();b.hide();MI.TalkBox.cur=a;MI.Bos("btnPic")}):UI.A(b._picForm,"target",l);UI.A(b._picForm,"action",f);b.picChange=function(){if(!/\.(png|jpg|jpeg|gif)$/.test(this.value.toLowerCase()))return MI.alert(_("仅支持jpg、jpeg、gif、png图片文件")),!1;a.uploadPic();b.PicUpTime=+new Date;b._picForm.submit();MI.TalkBox.cur=a;MI.Bos("btnPic")};b._picBtn.onchange=b.picChange;b._picDel.onclick=function(){a.delPic();MI.Bos("btnPicDel");return!1};b._picCancel.onclick=function(){a.cancelPic();MI.Bos("btnPicCancel");return!1}},showEvent:function(){},tabEvent:function(b,c){if(1==c||3==c||4==c){var e=b._div[c],d=["","PhotoMultiUpload","","Text2Pic","PhotoCameraUpload"][c],h=["","btnPhotoMulti","","btnText2Pic","btnPhotoCamera"][c];MI.app({TalkBoxRich:function(){MI[d].build(e,"http://api.t.qq.com/asyn/updateGrabPic.php");MI.TalkBox.cur=a}});MI.Bos(h)}else 2==c?b._sourcepicTxt.focus():5==c&&(MI.SearchPic?(MI.SearchPic.builded||MI.SearchPic.build(a),MI.SearchPic.show()):MI.app({TalkBoxRich:function(){MI.SearchPic&&(MI.SearchPic.build(a),MI.SearchPic.show())}}),MI.Bos("btnPicSearch"));b.flashCapture=0},hideEvent:function(a){a.resetSourcePic&&a.resetSourcePic();MI.app({TalkBoxRich:function(){MI.PhotoMultiUpload&&MI.PhotoMultiUpload.clear();MI.PhotoCameraUpload&&MI.PhotoCameraUpload.clear();MI.Text2Pic&&MI.Text2Pic.clear()}})}})};a._picAnchor.onclick=function(b){if(!MI.user.fun.qbUpload&&UI.hasClass(document.body,"ipad"))return UI.B.ipad?alert(_("此浏览器暂不支持图片上传，请到App Store下载并安装腾讯微博免费客户端。")):alert(_("此浏览器暂不支持图片上传，建议您使用QQ浏览器。")),MI.Bos("btnPicDisable"),UI.E(b).stop(),!1;a.picUploadBuild();a.upPic.show(0);return!1}}a._addReply&&(a._addReply.onclick=function(b){"A"==UI.E(b).target.nodeName&&(UI.hide(this),a._txt.value="",a.focus(),MI.Bos("btnAddReply"));return!1});a._addComt&&(a._addComt.onclick=function(){a._txt.focus();return!1});a._autoBackspace&&(a._autoBackspace.onclick=function(){var b=a._txt.value.length,c=MI.TalkBox.prototype.txtMax,e=a._txt.value.split("||");if(a.zhCount)if(MI.string.length(e[0])>=c)a._txt.value=e[0],MI.selectTxt(a._txt,b,b,b);else{for(;MI.string.length(e.join("||"))>2*c-20;)e.pop();a._txt.value=e.join("||");MI.selectTxt(a._txt,0,0,0)}else if(e[0].length>=c)a._txt.value=e[0],MI.selectTxt(a._txt,b,b,b);else{for(;e.join("||").length>c-20;)e.pop();a._txt.value=e.join("||");MI.selectTxt(a._txt,0,0,0)}a.countTxt();UI.hide(a._autoBackspace);a._txt.focus();MI.Bos("btnAutoBackspace");return!1});a._btn.onclick=function(){if(!(UI.hasClass(this,"btnNoStr")||MI.user.fun.sendBtnDisabledOnNoText&&UI.hasClass(a._btn,"disabled")))switch(a.countTxt(),a.send(),a.type){case null:"recom"==a.boxType&&MI.Bos("btnSendRecom");MI.Bos("btnSend","",0.01);break;case 1:MI.Bos("btnSendRelay");break;case 2:"trans"==a.boxType?MI.Bos("btnSendTrans"):MI.Bos("btnSendReply","",0.01);break;case 3:MI.Bos("btnSendMsg");break;case 4:MI.Bos("btnSendRelayList");break;case 5:MI.Bos("btnSendComt");break;case 6:MI.Bos("btnSendNotepad");break;case 7:"reFollow"==a.boxType&&MI.Bos("btnSendReFollow")}};a._close&&(a._close.onclick=function(){UI.B.ie&&UI.C(a._close,"right","9999px");setTimeout(function(){a.hide();UI.C(a._close,"right","")},0);MI.Bos("btnClose");return!1});a.addEvented=1}};MI.TalkBox.topic={};MI.TalkBox.prototype.cacheTopic=function(a){var b="option_topic_"+MI.user.account,c=0,e=[],d=MI.json(MI.S(b)),i={},a=a.match(/(#\s*[^#\s]{1}[^#]{0,39}?\s*#)/g),k;a&&UI.each(a,function(a){k=encodeURI(a);i[k]=1;delete d[k]});for(var p in d)p&&(i[p]=1);MI.TalkBox.topic=i;e.push("{");for(p in i){if(5<c)break;e.push((0==c?"":",")+'"'+p+'":1');c++}e.push("}");MI.S(b,e.join(""))};MI.TalkBox.prototype.addVote=function(){var a=this;if(!a.upVote){var b='<div class="voteDiv"><div class="m_voteBox clear">\t<form action="'+MI.url.vote+'" onsubmit="return false" name="voteAddFrom" id="voteAddFrom" target="voteAddIframe" method="post">\t<table><tr class="voteAddTr"><th>'+_("标题：")+'</th><td valign="top"><input type="text" name="sbjtitle" id="sbjtitle" class="inputTxt"><br><a href="#" class="ffsong addBrief">+'+_("添加说明")+'</a></td><td valign="top"><span class="voteAddError"></span></td></tr><tr class="voteAddTr" style="display:none"><th></th><td valign="top"><div><textarea name="brief" id="brief" class="inputTxt"></textarea></div></td><td valign="top"><span class="voteAddError"></span></td></tr><tr class="voteAddTr"><th>'+_("类型：")+'</th><td valign="top"><label><input class="check1" type="radio" name="ftype" id="ftype" value="1" checked>'+_("单选")+'</label> <label><input class="check1" type="radio" name="ftype" value="2">'+_("多选")+'</label></td><td><b class="voteAddError"></b></td></tr><tr class="voteAddTr"><th>'+_("选项：")+'</th><td valign="top">\t<ul><li><span class="index">1.</span><input type="text" name="opttitle" id="opttitle" class="inputTxt"></li><li><span class="index">2.</span><input type="text" name="opttitle" class="inputTxt"><div></div></li><li><span class="index">3.</span><input type="text" name="opttitle" class="inputTxt"><div></div></li><li><span class="index">4.</span><input type="text" name="opttitle" class="inputTxt"><div></div></li>\t</ul>\t<a href="#" class="voteAddOption ffsong">+'+_("增加选项")+'</a></td><td valign="top"><span class="voteAddError cNote"></span></td></tr>\t</table>\t<div class="right"><input type="submit" class="btn2" value="'+_("确定")+'"></p>\t</form></div><p class="cError" style="display:none"></p><iframe id="voteAddIframe" name="voteAddIframe" src="about:blank" style="display:none"></iframe>\t</div>';a.uploadCollection({type:null,name:"Vote",tab:[_("投票")],cnt:b,query:".voteDiv",className:"insertVote",flashTab:[],_open:a._vote,buildEvent:function(b){b._voteForm=o("voteAddFrom");b._voteOptions=d(b._box,"td ul")[0];b._voteAddOption=d(b._box,".voteAddOption")[0];b._addBrief=d(b._box,"a.addBrief")[0];UI.GT(b._tab[0],"a")[0].style.cssText="cursor:default;text-decoration:none";b._voteAddOption.onclick=function(){18<=d(this.parentNode,"li").length&&UI.hide(this);a.addVoteOption(b);return!1};b._addBrief.onclick=function(){var a=o("brief"),b=a.parentNode.parentNode.parentNode;a.value="";UI.toggle(b);this.innerHTML=this.innerHTML=="+"+_("添加说明")?"-"+_("不需要说明了"):"+"+_("添加说明");d(b,".voteAddError")[0].innerHTML="";try{a.focus()}catch(c){}return!1}},showEvent:function(b){MI.app({Validate:function(){new MI.Validate({id:"voteAddFrom",inputs:{sbjtitle:{rule:function(a){var a=UI.trim(a),b=a.length;a.split("");if(0==b)return _("这里一定要填")},noIco:!0},brief:{noIco:!0},ftype:{noIco:!0},opttitle:{rule:function(a,b){a=UI.trim(a);a.split("");var c=d(o("opttitle").parentNode.parentNode,"input"),k=0;UI.each(c,function(a){(value=UI.trim(a.value))&&k++});if(2>k&&b)return _("至少两个选项")},result:function(){var a=[],b=d(o("opttitle").parentNode.parentNode,"input"),c;UI.each(b,function(b){(c=UI.trim(b.value))&&a.push(c)});return a.join("||")},noIco:!0}},messages:function(a){return d(UI.parents(a,"voteAddTr")[0],".voteAddError")[0]},success:function(e){0==e.result?(a.addTopic(_("我发起了一个投票【{0}】，地址：",e.info.title)+"http://url.cn/"+e.info.url),a.focus(),a.vote=e.info.voteid,a.resetVote(),b.hide()):e.msg&&MI.alert(e.msg)}})}})}})}a.upVote.show(0)};MI.TalkBox.prototype.addVoteOption=function(a){var b=UI.html('<li><span class="index"></span><input type="text" name="opttitle" class="inputTxt"><div></div></li><li><span class="index"></span><input type="text" name="opttitle" class="inputTxt"><div></div></li>'),c=document.createDocumentFragment();UI.each(b,function(a){UI.append(a,c)});UI.append(c,a._voteOptions);if(a=d(a._box,"li .index"))for(var b=0,e=a.length;b<e;b++)a[b].innerHTML=b+1+"."};MI.TalkBox.prototype.resetVote=function(a){UI.show(a._voteAddOption);var b=d(a._voteOptions,"input");UI.each(b,function(a,b){3<b?UI.remove(a.parentNode):a.value=""});o("sbjtitle").value="";o("brief").value="";UI.hide(o("brief").parentNode.parentNode.parentNode);o("ftype").checked=!0;a._addBrief.innerHTML="+"+_("添加说明")};MI.SearchPic={talkBox:null,builded:!1,_tUrl:!1,_pSearch:null,_pSearchPage:null,_segword:"",_radioValue:"0",_preRadioValue:"0",_isPageClick:0,_pageNow:0,build:function(a){var b=this;if(!UI.A(a._searchPicBox,"builded")){this.PageNum=16;b.talkBox=a;var c=UI.html('<div class="loading" style="display:none;"></div><div class="p_searchBox clear"><span class="sosoLogo"><em class="ico_soso"></em>图片</span><form method="get"><input type="text" class="inputTxt" /><input type="submit" class="btn1" value="搜索"><p class="p_searchSel"><label><input type="radio" class="check1" name="picClass" value="0">表情图片</label><label><input type="radio" class="check1" name="picClass" value="1">普通图片</label></p></form></div>'),e=document.createDocumentFragment();UI.each(c,function(a){UI.append(a,e)});UI.prepend(e,a._searchPicBox);a._picSearchKey=d(a._searchPicBox,".inputTxt")[0];a._picSearchBtn=d(a._searchPicBox,".btn1")[0];a._picSearchFrom=d(a._searchPicBox,"form")[0];b._sLoading=d(a._searchPicBox,".loading")[0];a._radioInput=d(a._searchPicBox,".p_searchSel label");d(a._radioInput[0],".check1")[0].checked=!0;var h=document.getElementsByName("picClass");UI.each(h,function(a){!0==a.checked&&(b._preRadioValue=b._radioValue=a.value)});UI.show(b._sLoading);UI.getScript("http://cache.soso.com/js/an-app.js",function(){});a._radioInput[0].onmousedown=a._radioInput[1].onmousedown=a._picSearchBtn.onclick=a._picSearchFrom.onsubmit=function(c){c=UI.E(c).target;"label"==c.nodeName.toLowerCase()||"check1"==c.className?(b._preRadioValue=b._radioValue,b._radioValue="label"==c.nodeName.toLowerCase()?UI.A(d(c,".check1")[0],"value"):UI.A(c,"value"),MI.Bos("BtnSearchClass_"+b._radioValue)):h&&UI.each(h,function(a,c){!0==a.checked&&(b._preRadioValue=b._radioValue,b._radioValue=a.value,MI.Bos("BtnSearchClass_"+c))});b.searchPic(a._picSearchKey.value,0,b._radioValue);window.__sosostat&&window.__sosostat.prget&&__sosostat.prget(document.location.href,"t.1.1.0",0,"bq_app");MI.Bos("btnPicSearchGo");return!1};b.searchPic("",0);UI.hide(b._sLoading);UI.A(a._searchPicBox,"builded",1)}},tmpl:'<div class="p_sResult"><%if(errCode == 0){%>\t<%var allnum = general.allnum,segword = general.segword;%>\t<%if(items.length > 0){%><div class="p_sList">\t<ul class="clear"><%for(var i=0,n=items.length;i<n;i++){%>\t<%var px,\tpicid = items[i].MD,\tSrc = items[i].SRC,\tsSrc = items[i].SSRC,\ttit = items[i].TI || "";%>\t<%if(i%8 > 3){px="4px"}else{px ="";}%>\t<li><a href="<%=Src%>" rel="<%=px%>" onclick="return false;"><img id="<%=picid%>" src="<%=sSrc%>" alt="<%=tit%>" title="<%=tit%>" /></a></li><%}%>\t</ul></div><%if(segword){%>\t<p class="p_sNum">'+_("搜索到")+'<b><%=allnum%></b>个和<span class="cSign"><%=segword%></span>'+_("相关的图片")+"</p><%}%>\t<%}%><%}%>\t</div>",show:function(){},searchPic:function(a,b,c,e){function d(){window.jsonSoSoPic&&("0"==i._radioValue?i.searchPicCallBack(jsonSoSoPic.sosovdap.expression):"1"==i._radioValue&&i.searchPicCallBack(jsonSoSoPic.sosovdap.image))}var i=this,b=0<parseInt(b)?parseInt(b):0,a=MI.string.html(a);i._Key=a;i._isPageClick=null!=e&&1==e?1:0;var e="http://vdap.soso.com/service",k=["src=37&ie=utf8&mark=MD|SRC|SSRC|TI&ofmt=json&nu=16","w="+UI.encode(a),"sn="+b,"r="+MI.random(),"var=jsonSoSoPic"],e=e+("?"+(null!=c?"1"==c?"kd=i&ity=1&size=1":"kd=e&ng=on":"kd=e&ng=on"))+("&"+k.join("&")),c=MI.url.uploadSearchPic+"?p="+b+"&var=jsonSoSoPic&r="+MI.random(),b=e;""==UI.trim(a)?(b=c,i._tUrl=1):(b=e,i._tUrl=0);i._tUrl?MI.ajax({url:b,success:function(a){try{eval(a)}catch(b){}d()}}):UI.getScript(b,function(){d()},"gb2312")},searchPicCallBack:function(a){var b=this;if(a&&0==a.errCode){var c;UI.hide(b._sLoading);a.general&&!a.general.segword&&(a.general.segword="");b._noResult&&UI.remove(b._noResult);b._pSearch=d(b.talkBox._searchPicBox,".p_sResult")[0];UI.show(b._pSearch);b.talkBox._pSearchPage||(c=UI.html('<div class="pages"></div>')[0],UI.append(c,b._pSearch),b.talkBox._pSearchPage=new MI.Page({target:c,num:2,call:function(a){b.searchPic(b._Key,b._tUrl?a:16*(a-1),b._radioValue,1)}}),c=Math.ceil(a.general.allnum/b.PageNum),b._pageNow=999<c?999:c,b.talkBox._pSearchPage.show(0,b._pageNow,!1),b._segword=b._Key);b.searchPage(a);if((0!=a.errCode||a.general.allnum<b.PageNum)&&b.talkBox._pSearchPage&&b.talkBox._pSearchPage.target)UI.remove(b.talkBox._pSearchPage.target),b.talkBox._pSearchPage=null;b._pSearch&&!b.p_Preview&&(a=UI.html('<div class="picPreview" style="visibility:hidden;"><img style="max-width:97px;max-height:97px;" src="http://mat1.gtimg.com/www/mb/images/loading.gif" alt=""></div>')[0],UI.append(a,b._pSearch),b.p_Preview=a,b.p_img=d(a,"img")[0])}else a&&0!=a.errCode&&(UI.hide(b._sLoading),b._pSearch&&UI.hide(b._pSearch),b._noResult&&UI.remove(b._noResult),a=UI.html('<div class="p_noResult"><p>'+_("对不起，未找到")+'<b>"'+b._Key+'"</b>'+_("的相关图片。")+"</p><p>"+_("请检查关键词是否正确，或更换其他关键字搜索。")+"</p></div>")[0],UI.append(a,b.talkBox._searchPicBox),b._noResult=a)},searchPage:function(a){if(a&&0==a.errCode){var b=UI.html((new UI.tmplString(this.tmpl))(a)),c=document.createDocumentFragment();UI.each(UI.children(b[0]),function(a){UI.isElement&&UI.append(a,c)});var b=d(this._pSearch,".p_sNum")[0],e=d(this._pSearch,".p_sList")[0],h=d(this._pSearch,".p_noResult")[0],i=d(this._pSearch,".pages")[0];b&&UI.remove(b);e&&UI.remove(e);h&&UI.remove(h);if(i&&!this._isPageClick&&(this._preRadioValue!=this._radioValue||UI.trim(this._segword)!=UI.trim(this._Key)))a=Math.ceil(a.general.allnum/this.PageNum),this._pageNow=999<a?999:a,this.talkBox._pSearchPage.show(0,this._pageNow,!1),this._segword=UI.trim(this._Key);UI.prepend(c,this._pSearch);if(this.m_total=d(this._pSearch,".p_sNum")[0])(this.cSign=d(this.m_total,".cSign")[0])&&(this.cSign.innerHTML=UI.trim(MI.string.cut(this._Key,16)));999==this._pageNow&&(d(this._pSearch,".p_sNum b")[0].innerHTML=16*this._pageNow);this.bindEvent(d(this._pSearch,".p_sList")[0])}},bindEvent:function(a){if(a){var b=this;if("1"==b._radioValue){var c=d(a,"li img");UI.each(c,function(a){a.style.width="48px"})}a.onmouseover=function(a){var c=UI.E(a);"IMG"==c.target.nodeName?setTimeout(function(){b.p_img.src="1"==b._radioValue?c.target.src:UI.parent(c.target).href;b.p_Preview.style.left=UI.parent(c.target).rel;b.p_Preview.style.visibility="visible"},10):setTimeout(function(){b.p_Preview.style.visibility="hidden"},10);c.stop()};a.onmouseout=function(a){a=UI.E(a);"IMG"==a.target.nodeName&&setTimeout(function(){b.p_Preview.style.visibility="hidden";UI.A(b.p_img,"load",0)},10);a.stop()};a.onclick=function(a){a=UI.E(a);"IMG"==a.target.nodeName&&(UI.hide(b.talkBox.upPic._box),UI.append(b.talkBox._uploadPicS,b.talkBox._sendStatus),!UI.hasClass(b.talkBox._sendCnt,"hasMedia")&&UI.addClass(b.talkBox._sendCnt,"hasMedia"),UI.addClass(b.talkBox._picLoading,"loading"),UI.show(b.talkBox._picLoading),MI.ajax({url:MI.url.uploadUrlPic,type:"get",data:"sourcepic="+encodeURIComponent(UI.parent(a.target).href)+"&r="+MI.random(),success:function(a){a=MI.json(a);0==a.result&&a.info?b.talkBox.addPic({result:0,msg:_("上传成功"),info:{image:a.info.image,fileName:_("搜图.jpg")}}):(-7==a.result&&MI.talkBox.delPic(),MI.dialog.alert(a.msg||_("图片上传失败，请重试")))}}),window.__sosostat&&window.__sosostat.prget&&__sosostat.prget(document.location.href,"t.2.2."+a.target.id,0,"bq_app"),MI.Bos("btnPicSearchUse"));a.stop();return!1}}}};MI.PhotoMultiUpload={html:"",sendBtn:null,cancelBtn:null,uploadUrl:"",build:function(a,b){var c=this;c.html=MI.Flash.getObject(null,MI.swf.MultiPhoto,462,165,"MultiPhoto");if(10.3>MI.Flash.getVersion())a.innerHTML=MI.Flash.updateTip(10.3);else if(c.uploadUrl=b||"http://upload.t.qq.com",c.builded)UI.C(c.loading,"opacity",1),UI.show(c.loading),c.show(),UI.B.ie6&&c.resizeLoading();else return c.target=a,c.sendBtn=d(a,".btnSend")[0],c.cancelBtn=d(a,".btnCancel")[0],c.flashWrap=d(a,".flashWrap")[0],c.loading=d(a,".maskLoading")[0],c.tip=d(a,".error")[0],c.flashWrap.innerHTML=c.html,c.builded=1,c.sendBtn.onclick=function(){c.upload()},c.cancelBtn.onclick=c.hide,window._flash_resizeFlashHeight=function(a){c.resetSize(a)},window._flash_multiUploadCall=function(a){c.uploadCall(a)},window._flash_setMultiTip=function(a){c.setTip(a)},window._flash_MultiLoaded=function(){c.show()},!1},show:function(){document.MultiPhoto&&document.MultiPhoto.multiPic_startSave&&(UI.hide(this.loading),UI.C(this.loading,"opacity",0.5))},hide:function(){MI.TalkBox.cur.upPic.hide()},captureImg:function(a){document.MultiPhoto&&document.MultiPhoto.multiPic_captureImg(a)},upload:function(){UI.B.ie6&&this.resizeLoading();UI.show(this.loading);document.MultiPhoto.multiPic_startSave(this.uploadUrl,"_flash_multiUploadCall");MI.Bos("btnPhotoMultiSend")},clear:function(){document.MultiPhoto&&document.MultiPhoto.multiPic_clearStage&&document.MultiPhoto.multiPic_clearStage();UI.hide(this.loading)},resetSize:function(a){this.setTip("");document.MultiPhoto&&(document.MultiPhoto.height=1*a);a=UI.getY(this.flashWrap)+a+100-UI.windowHeight();(0<=a||225<UI.scrollY())&&window.scrollTo(0,a)},resizeLoading:function(){UI.C(this.loading,"height",UI.height(this.target))},uploadCall:function(a){UI.hide(this.loading);a=MI.json(a);0==a.result?(MI.TalkBox.cur.upPic.hide(),this.clear(),MI.TalkBox.cur.upPic.flashCapture=0,setTimeout(function(){MI.tip(_("上传成功"),function(){MI.TalkBox.cur.addPic({result:0,msg:_("上传成功"),info:{image:a.info.image,path:a.info.path,host:a.info.host,fileName:_("多图")+".jpg"}})})},0)):MI.alert(a.msg)},setTip:function(a){this.tip.innerHTML=a}};MI.PhotoCameraUpload={html:"",sendBtn:null,cancelBtn:null,uploadUrl:"",build:function(a,b){var c=this;if(10>MI.Flash.getVersion())a.innerHTML=MI.Flash.updateTip(10);else if(c.html=MI.Flash.getObject(null,MI.swf.CameraPhoto,462,335,"CameraPhoto"),c.uploadUrl=b||"http://upload.t.qq.com",c.builded)UI.C(c.loading,"opacity",1),UI.show(c.loading),c.show(),UI.B.ie6&&c.resizeLoading(),UI.B.firefox&&UI.hide(c.ButtonWrap);else return c.target=a,c.sendBtn=d(a,".btnSend")[0],c.cancelBtn=d(a,".btnCancel")[0],c.flashWrap=d(a,".flashWrap")[0],c.buttonWrap=d(a,".clear")[0],c.loading=d(a,".maskLoading")[0],c.tip=d(a,".tip")[0],c.flashWrap.innerHTML=c.html,c.builded=1,c.sendBtn.onclick=function(){c.upload()},c.cancelBtn.onclick=c.hide,window._flash_resetCameraHeight=function(a){c.resetSize(a)},window._flash_cameraUploadCall=function(a){c.uploadCall(a)},window._flash_setCameraTip=function(a){c.setTip(a)},window._flash_cameraLoaded=function(a){c.show();1==a&&UI.show(c.buttonWrap)},!1},show:function(){document.CameraPhoto&&document.CameraPhoto.camera_startSave&&(UI.hide(this.loading),UI.C(this.loading,"opacity",0.5))},hide:function(){MI.TalkBox.cur.upPic.hide()},upload:function(){UI.B.ie6&&this.resizeLoading();this.setTip("");UI.show(this.loading);document.CameraPhoto.camera_startSave(this.uploadUrl,"_flash_cameraUploadCall");MI.Bos("btnPhotoCameraSend")},clear:function(){this.setTip("");document.CameraPhoto&&document.CameraPhoto.camera_clearStage&&document.CameraPhoto.camera_clearStage();this.buttonWrap&&UI.hide(this.buttonWrap);this.loading&&UI.hide(this.loading)},resetSize:function(a){this.setTip("");document.CameraPhoto&&(document.CameraPhoto.height=1*a);a=UI.getY(this.flashWrap)+a+100-UI.windowHeight();(0<=a||225<UI.scrollY())&&window.scrollTo(0,a)},resizeLoading:function(){UI.C(this.loading,"height",UI.height(this.target))},uploadCall:function(a){UI.hide(this.loading);a=MI.json(a);0==a.result?(MI.TalkBox.cur.upPic.hide(),this.clear(),setTimeout(function(){MI.tip(_("上传成功"),function(){MI.TalkBox.cur.addPic({result:0,msg:_("上传成功"),info:{image:a.info.image,path:a.info.path,host:a.info.host,fileName:_("拍照")+".jpg"}})})},0)):this.setTip(a.msg)},setTip:function(a){this.tip&&(this.tip.innerHTML=a)}};MI.swf.VideoRecord="http://mat1.gtimg.com/www/mb/swf/VideoRecord_111206.swf";MI.VideoRecord={html:"",uploadUrl:"",build:function(a,b){var c=this;if(10>MI.Flash.getVersion())a.innerHTML=MI.Flash.updataTip(10);else if(c.html=MI.Flash.getObject(null,MI.swf.VideoRecord,462,335,"VideoRecord"),c.uploadUrl=b||"http://upload.t.qq.com",c.builded)UI.C(c.loading,"opacity",1),UI.show(c.loading),c.show(),UI.B.ie6&&c.resizeLoading(),UI.B.firefox&&UI.hide(c.ButtonWarp);else return c.target=a,c.flashWrap=d(a,".flashWrap")[0],c.buttonWrap=d(a,".clear")[0],c.loading=d(a,".maskLoading")[0],c.tip=d(a,".tip")[0],c.flashWrap.innerHTML=c.html,c.builded=1,window.jfRecordUploadCall=function(){c.uploadCall()},window.jfRecordUploadError=function(a){c.uploadError(a)},window.jfTweet=function(a){c.tweet(a)},window.jfGetKeyFail=function(){c.getKeyFail()},window.jfRecordLoaded=function(){c.show()},window.jfGetUserAccount=function(){return MI.user.account},c.show(),!1},show:function(){document.VideoRecord&&document.VideoRecord.fjClearStage&&(UI.hide(this.loading),UI.C(this.loading,"opacity",0.5))},hide:function(){},upload:function(){},uploadCall:function(){UI.show(this.loading);MI.Bos("btnVideoRecordSend")},uploadError:function(a){MI.tip(a)},getKeyFail:function(){UI.hide(this.loading);MI.TalkBox.cur.upVideo.hide();this.clear();MI.alert("今天上传达到最大数量!")},tweet:function(a){UI.hide(this.loading);MI.TalkBox.cur.upVideo.hide();this.clear();MI.talk("视频录制成功!","#分享视频#http://boke.qq.com/play.html?v="+a,40,{vid:a,msg:"该微博会在转码完毕后发布，届时将会收到私信通知"})},clear:function(){document.VideoRecord&&document.VideoRecord.fjClearStage&&document.VideoRecord.fjClearStage();this.loading&&UI.hide(this.loading)}};MI.Text2Pic={html:"",theme:0,build:function(a,b){var c=this;if(9>MI.Flash.getVersion())a.innerHTML=MI.Flash.updateTip(9);else if(c.html=MI.Flash.getObject(null,MI.swf.Text2Pic,462,10,"Text2Pic"),c.uploadUrl=b,c.txtMinHeight=[98,104,52,69],c.builded)UI.B.ie&&!c.flashWrap.innerHTML&&(c.flashWrap.innerHTML=c.html),UI.C(c.loading,"opacity",1),UI.show(c.loading),c.show();else return c.target=a,c.flashWrap=d(a,".flashWrap")[0],c.sendBtn=d(a,".btnSend")[0],c.cancelBtn=d(a,".btnCancel")[0],c.tip=d(a,".tip")[0],c.txt=d(a,".longText")[0],c.txtCnt=d(a,".txtCnt")[0],c.loading=d(a,".maskLoading")[0],c.themeLink=d(a,".typeSel a"),c.sendBtn.onclick=function(){c.upload()},c.cancelBtn.onclick=c.hide,c.flashWrap.innerHTML=c.html,c.builded=1,window._flash_Text2PicUploadCall=function(a){c.uploadCall(a)},window._flash_Text2PicTip=function(a){c.setTip(a,!0)},window._flash_Text2PicLoaded=function(){c.show();c.txt.focus()},UI.each(c.themeLink,function(a,b){a.onclick=function(){UI.B.ie||c.txt.focus();c.theme=b;c.txtCnt.className="txtCnt type"+(b+1);UI.each(c.themeLink,function(a,c){b==c?UI.addClass(a,"select"):UI.removeClass(a,"select")});var a=c.txtMinHeight[b];UI.C(c.txt,"height",a+"px");c.txt.scrollHeight<=a?c.txt.style.height=c.txt.parentNode.style.height=a+"px":c.resetTxtHeight(c.txt);setTimeout(function(){MI.selectTxt(c.txt,c.txtCurX,c.txtCurX)},100);MI.Bos("btnText2PicTheme"+(b+1));return!1};a.onmousedown=function(){c.txtCurX=MI.cursorX(c.txt)||0}}),c.txt.onkeyup=c.txt.onmouseup=c.txt.oninput=function(){c.resetTxtHeight(c.txt)},UI.B.ie||(c.flashWrap.style.cssText="position:absolute;z-index:-2;top:0;"),!1},resetTxtHeight:function(a){var b=this,c=b.txtMinHeight[b.theme];clearTimeout(b.delayHeight);b.delayHeight=setTimeout(function(){b.txt.style.height=c+"px";c=a.scrollHeight>c?a.scrollHeight:c;b.txt.style.height=b.txt.parentNode.style.height=c+"px";MI.cursorX(a)>=a.value.length&&(b.txtCnt.scrollTop=2*c)},100)},show:function(){document.Text2Pic&&document.Text2Pic._Text2PicBuildImg&&(UI.hide(this.loading),UI.C(this.loading,"opacity",0.5),this.txt.focus());this.resetTxtHeight(this.txt)},hide:function(){MI.TalkBox.cur.upPic.hide()},upload:function(){var a=this.txt.value,b=MI.string.length(a);UI.trim(a)?4E3<b?this.setTip(_('字数超出<span class="error">{0}</span>字，请删减',Math.ceil((b-4E3)/2)),!0):(clearTimeout(this.delay),UI.show(this.loading),this.setTip(_("正在转换成图片，请稍候...")),a=("\n"+a+"\n\n").replace(/  /g," ").replace(/\t/g,"    "),document.Text2Pic._Text2PicBuildImg(this.uploadUrl,a,"_flash_Text2PicUploadCall",MI.Flash.version,this.theme),MI.Bos("btnText2PicSend")):(this.setTip(_('<span class="error">文本不能为空</span>'),!0),this.txt.focus())},uploadCall:function(a){var b=this.txt.value;UI.hide(this.loading);a=MI.json(a);0==a.result?(UI.hide(this.tip),this.setSummary(),MI.TalkBox.cur.upPic.hide(),setTimeout(function(){MI.tip(_("上传成功"),function(){MI.TalkBox.cur.addPic({result:0,msg:_("上传成功"),info:{image:a.info.image,path:a.info.path,host:a.info.host,fileName:_("文图")+".jpg"}});MI.TalkBox.cur.longText=b})},0)):this.setTip('<span class="error">'+a.msg+"</span>",!0)},setTip:function(a,b){var c=this;clearTimeout(c.delayTip);c.tip.innerHTML=a;c.tip.style.display="block";b?(c.tip.style.paddingLeft="20px",c.tip.style.backgroundPosition="15px 200%",c.delayTip=setTimeout(function(){UI.hide(c.tip)},1E3)):(c.tip.style.paddingLeft="40px",c.tip.style.backgroundPosition="15px 50%");c.tip.style.left=(492-UI.width(c.tip))/2+"px"},clear:function(){this.txt&&(this.txt.value="");this.tip&&UI.hide(this.tip);this.flashWrap&&UI.B.ie&&(this.flashWrap.innerHTML="")},formTalk:function(a,b){var c=this;MI.user.fun.autoTxt2Pic&&(c.useTxt2Pic||(c.useTxt2Pic=UI.html('<span class="text2PicBtn" style="float:right;height:30px;line-height:30px;margin-left:5px;">[<a href="#">'+_("转成图片")+"</a>]</span>")[0],UI.before(c.useTxt2Pic,a._tip),UI.GT(c.useTxt2Pic,"a")[0].onclick=function(){a.upPic||a.picUploadBuild();a.upPic.show(3);c.txt.focus();c.txt.value=a._txt.value;c.txt.scrollTop=c.txt.scrollHeight;a._txt.value="";a.countTxt();MI.Bos("btnText2PicFormTalk");return!1}),b?UI.show(c.useTxt2Pic):UI.hide(c.useTxt2Pic))},setSummary:function(){var a=MI.TalkBox.cur._txt,b="",c=[],e,d="",i=/@([a-zA-Z]|[\u4e00-\u9fa5])([a-zA-Z0-9_-]|[\u4e00-\u9fa5]){0,19}/g;topicReg=/(#\s*[^#\s]{1}[^#]{0,59}?\s*#)/g;urlReg=RegExp("((news|telnet|nttp|file|http|ftp|https)://){1}(([-A-Za-z0-9]+(\\.[-A-Za-z0-9]+)*(\\.[-A-Za-z]{2,5}))|([0-9]{1,3}(\\.[0-9]{1,3}){3}))(:[0-9]*)?(/[-A-Za-z0-9_\\$\\.\\+\\!\\*\\(\\),;:@&=\\?/~\\#\\%]*)*","gi");zhCount=window.MILang&&"en_US"==window.MILang?0:1;len=MI.countTxt(a.value,!0,zhCount);n=100>=len?100-len:0;if(!(139<=len)){b=this.txt.value.replace(urlReg,function(a){c.push(a);return""});0<n&&(d=MI.string.cut(b,2*n,"......").replace(/@([a-zA-Z]|[\u4e00-\u9fa5])([a-zA-Z0-9_-]|[\u4e00-\u9fa5]){0,19}(?=\.\.\.$)/,"......"));e=b.match(topicReg)||[];var k=(d.match(/#\s*[^#\s]{1}[^#]{0,59}?\s*(?=\.\.\.)/g)||[])[0];k&&e.join("").hasString(k)&&(d=d.replace(/#\s*[^#\s]{1}[^#]{0,59}?\s*\.\.\./g,"......"));b=(b.match(i)||[]).concat(e).concat(c);UI.each(b,function(b){topicReg.test(b)&&2<=((a.value+d).match(topicReg)||[]).length||d.hasString(b)||MI.countTxt(d+b,!0)+1>140-len||(d+=" "+b+" ")});MI.TalkBox.cur.txtSummary=d;a.value.hasString(d)||(a.value+=d);MI.TalkBox.cur.countTxt();MI.TalkBox.cur.focus()}}};MI.photoFilter={html:'<div class="filterPic" style="width:517px;padding:5px 0;text-align:center"><div class="flashWrap"></div><div class="clear"><p style="text-align:right;padding:5px;" class="btnBox"><span class="error" style="padding-right:20px"></span><button class="btn3 btnSend">'+_("确定")+'</button>&nbsp;<button class="btnCancel btn_cancel">'+_("取消")+"</button></p></div></div>",flashHtml:"",body:null,sendBtn:null,cancelBtn:null,sourceUrl:"",uploadUrl:"",build:function(a,b){var c=this;if(9>MI.Flash.getVersion())MI.dialog.show({html:MI.Flash.updateTip(9)});else if(c.flashHtml=MI.Flash.getObject(null,MI.swf.FilterPhoto,462,250,"FilterPhoto"),c.sourceUrl=a,c.uploadUrl=b,c.body)c.show();else return c.body=UI.html(c.html)[0],c.sendBtn=d(c.body,".btnSend")[0],c.cancelBtn=d(c.body,".btnCancel")[0],c.tip=d(c.body,".error")[0],c.flashWrap=d(c.body,".flashWrap")[0],c.sendBtn.onclick=function(){c.upload()},c.cancelBtn.onclick=function(){c.hide()},window._flash_resetFilterSize=c.resetSize,window._flash_filterUploadCall=c.uploadCall,window._flash_setfilterTip=function(a){c.setTip(a)},c.show(),!1},show:function(){var a=this;MI.dialog.show({title:'<h3 class="DmainTit">'+_("魔法滤镜")+"</h3>",html:a.body,width:542,start:function(){a.flashWrap.innerHTML=a.flashHtml}});MI.dialog.showLoad();a.pushImg()},pushImg:function(){var a=this;clearTimeout(a.delay);document.FilterPhoto&&document.FilterPhoto.sendImgUrl_ToFlash?document.FilterPhoto.sendImgUrl_ToFlash(a.sourceUrl):a.delay=setTimeout(function(){a.pushImg()},100)},upload:function(){var a=this;MI.dialog.showLoad();setTimeout(function(){document.FilterPhoto.filter_upload(a.uploadUrl,"_flash_filterUploadCall")},100);MI.Bos("btnPhotoFilterSend")},hide:function(){MI.dialog.hide();UI.remove(this.body);MI.Bos("btnPhotoFilterClose")},resetSize:function(a,b){if(document.FilterPhoto){document.FilterPhoto.width=a;document.FilterPhoto.height=b;var c=d(document.body,".CR")[0];c&&window.scrollTo(0,parseInt(c.style.top)+(UI.height(c)-UI.windowHeight())/2)}},uploadCall:function(a){MI.dialog.hideLoad();a=MI.json(a);0==a.result?setTimeout(function(){MI.tip(_("上传成功"),function(){MI.TalkBox.cur.addPic({result:0,msg:_("上传成功"),info:{image:a.info.image,path:a.info.path,host:a.info.host,fileName:_("滤镜")+".jpg"}})})},0):MI.alert(a.msg)},setTip:function(a){this.tip.innerHTML=a}};MI.SendGift=function(a){this.eventId=a.eventId;this.title=a.title;this.topic=a.topic;this.selectOpt=a.selectOpt;this.bodyClass=a.bodyClass||"";this.giftConfig=a.giftConfig||[];this.placeHolder=a.placeHolder||_("选择或输入好友");this.index=this.index||0;this.publishBos=a.publishBos;this.btnValue=a.btnValue;this.recordTabName=a.recordTabName;this.wordingList=a.wordingList;this.friendTitle=a.friendTitle;this.init()};MI.SendGift.prototype={atReg:/@([a-zA-Z]|[\u4e00-\u9fa5]|\*)([a-zA-Z0-9_-]|[\u4e00-\u9fa5]){0,19}/g,getHtml:function(){return'<div class="sendGiftWrap dialogTalkBox '+this.bodyClass+'"><div class="chrisBg"><p class="chrisTipTop"></p><div class="sendCnt chrisFrm clear" style="display:;"><dl><dt>'+_("送给")+'：</dt><dd><input type="text" value="'+this.placeHolder+'" class="chirsPut sendTo"></dd><dt>'+_("祝福")+'：</dt><dd><textarea class="chrisArea sendWord inputTxt"></textarea><div class="bot"><div class="sendStatus clear"></div><div class="insertFun"><div class="sendList insertFace"><a class="txt" href="#" title="'+_("表情")+'"><em class="sico ico_face"></em></a></div><div class="sendList uploadMusic"><a class="txt" href="#" title="'+_("可按歌名、歌手名搜索并添加音乐")+'" tabindex="3"><em class="sico ico_audio"></em></a></div></div><div class="left"></div><input type="button" class="inputBtn sendBtn" value="'+_("广 播")+'"><span class="countTxt">'+_("还能输入{0}字","<em>140</em>")+'</span>\t</div></dd></dl><div class="cPrizeRig"><p>'+_("选择礼物")+'：<span  class="giftName"></span></p><div class="chrisPrizeFrm" style="width:180px"><a class="cArrowLeft prev" href="#" style="margin:0;left:0;"></a><ul class="cPrizeCont giftList"></ul><a class="cArrowRight next" href="#"></a></div><p class="cPrizeNum page"></p></div></div></div></div>'},init:function(){var a=this;a.build();a.div=[];a.talkArray=[];a.myFriendArray={};a.myFriendList=[];a.domTitle='<ul class="pr_rep_tit va_tab_re">';UI.each(a.title,function(b,c){a.domTitle+='<li class="vaTab'+(c+1)+'"><a href="#">'+b+"</a></li>"});a.domTitle+="</ul>";a.myFriend=UI.html('<div class="pr_friend_pn"><p class="pr_friend_hd">'+a.friendTitle+'</p><div class="pr_friend_bd"><div  class="loading">'+_("数据加载中")+"</div></div></div>")[0];a.div[0]=d(a.body,".chrisFrm")[0];UI.css(".anony_pn th {display:none;}.anony_pn .sendList{display:none !important;}.anony_pn .txtWrap {display:none;}");a.div[1]=UI.html('<div class="art_pn sendCnt anony_pn" style="display:none;"><p class="anonyFont">'+_("爱TA在心口难开？树洞帮你来告白！")+'</p><p class="anonyInfo">（'+_("树洞会把你的告白广播出去，勇敢@她/他，没人知道是你发的哦~详见")+'<a target="_blank" href="http://t.qq.com/k/%E6%A0%91%E6%B4%9E%E5%91%8A%E7%99%BD">#'+_("树洞告白")+"#</a>）</p>"+MI.tmpl.msgBox.replace("uploadPic","")+"</div>")[0];UI.after(a.div[1],a.div[0]);UI.after(a.myFriend,a.div[1]);a.msgBox=new MI.MsgBox(a.div[1]);a.msgBox.noRelTopic=1;a.msgBox.topic=a.topic[1];a.msgBox._msgTo.value="weiboshudong";a.msgBox._btn.value=_("扔进树洞");a.msgBox.txtMax=140-MI.countTxt(a.msgBox.topic);a.msgBox.success=function(b){a.publishSuccess(b,1)};a.talkArray[0]=a.talk;a.talkArray[0].faceHideTabIndex={3:3}},build:function(){var a=this;a.body=UI.html(a.getHtml())[0];a.sendTo=d(a.body,".sendTo")[0];a.giftBox=d(a.body,".cPrizeRig")[0];a.giftList=d(a.body,".giftList")[0];a.giftName=d(a.body,".giftName")[0];a.listHtml="";UI.each(a.giftConfig,function(b){a.listHtml+='<li><span style="background:url('+b.pic+");_background:none;_filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=crop,src='"+b.pic+"')\"></span></li>"});a.giftList.innerHTML=a.listHtml;a.talk=a.bindTalkEvent(d(a.body,".chrisFrm")[0],0,1);a.sendWord=a.talk._txt;UI.EA(a.sendWord,"focus",function(){var b=RegExp(_("#(分享音乐|分享音樂)#"));a.talk.txtMusic&&b.test(a.talk.txtMusic)&&setTimeout(function(){a.talk.txtMusic=a.talk.txtMusic.replace(b,"");a.sendWord.value&&(a.sendWord.value=a.sendWord.value.replace(b,""))},100)});UI.EA(a.sendTo,"blur",function(){a.talk.countTxt()});MI.app({ItemSelect:function(){a.select=new MI.ItemSelect(a.selectOpt||{target:a.sendTo,type:1,splitStr:" ",dataUrl:MI.url.userFriends,queryData:{u:MI.user.account,t:"3,2,1"},noResultTip:_("你还没有好友"),noSearchTip:_("没找到匹配的好友，请重新输入"),awaysSetPos:1});a.selectHandler&&a.selectHandler()}});UI.EA(a.sendWord,"focus",function(){a.select.hide()});a.builded=1},buildSlide:function(){var a=this;MI.app({Slide:function(){UI.C(a.giftList,"width",180*a.giftConfig.length+"px");a.slide=new MI.Slide({target:a.giftBox,tmpl:'<%for(var i=0;i<num;i++){%><a href="#" class="<%if(i==0){%>on<%}%>"><%=i+1%></a><%}%>',call:function(b){a.changeGift(b-1)}});a.changeGift(0)}})},selectHandler:function(){var a=this;a.select.pullData(function(b){var c="",e=0;UI.each(b,function(b){13>e&&(c+='<a href="#" data-account="'+b.name+'" title="'+b.nick+'"><img src="'+b.url+'/30"/></a>',a.myFriendArray[b.name]=e);e++});c=c.replace(/src="\/30"/gi,'src="http://mat1.gtimg.com/www/mb/images/head_30.jpg"');UI.GT(a.myFriend,"div")[0].innerHTML=c;a.myFriendList=UI.GT(a.myFriend,"a")});UI.EA(a.myFriend,"click",function(b){var b=UI.E(b),c=b.target.nodeName.toLowerCase();if("a"==c||"img"==c){var c="a"==c?b.target:b.target.parentNode,e=UI.A(c,"data-account");UI.hasClass(c,"on")?(UI.removeClass(c,"on"),a.select.selectEvent(e),a.changeTalkValue(e,0)):(UI.addClass(c,"on"),a.changeTalkValue(e,1),a.select.unSelectEvent(e));2!=a.currTab&&a.talkArray[1*a.currTab||0].countTxt();MI.Bos("btnSpringFriendClick")}a.select.selected.num>a.select.max?a.select.show():a.select.hide();b.prevent();b.stop()});a.select.refreshDataEvent=function(b){a.myFriend&&(UI.each(a.myFriendArray,function(c,e){UI.hasKey(b,e)?UI.hasClass(a.myFriendList[c],"on")||(UI.addClass(a.myFriendList[c],"on"),a.changeTalkValue(e,1)):UI.hasClass(a.myFriendList[c],"on")&&(UI.removeClass(a.myFriendList[c],"on"),a.changeTalkValue(e,0))}),UI.each(b,function(b){b=b.name;UI.hasKey(a.myFriendArray,b)||a.changeTalkValue(b,1)}))}},changeTalkValue:function(a,b){var c="@"+a;UI.each(this.talkArray,function(a){if(a){var d=a._txt.value,i=d.hasString(c);b?i||(a._txt.value=(d+" "+c+" ").replace(/  /g," ")):i&&(a._txt.value=d.replace(RegExp(c,"g"),""))}});this.talkArray[this.currTab].countTxt()},changeSelectData:function(a){var b=this,c=a._txt.value.match(b.atReg)||[];UI.each(b.select.selected.data,function(a){a=a.name;UI.has(c,"@"+a)||(b.select.selectEvent(a),b.changeTalkValue(a,0))});UI.each(b.select.unSelected.data,function(a){a=a.name;UI.has(c,"@"+a)&&(b.select.unSelectEvent(a),b.changeTalkValue(a,1))})},bindTalkEvent:function(a,b,c){var e=this,h=new MI.TalkBox(a,{noFlash:c,data:{eventId:e.eventId}}),a=d(a,".sendBtn")[0];h.noRelTopic=1;h.topic=e.topic[b]+" ";h.txtMax=140-MI.countTxt(e.topic[b]);if(11==MI.boss||13==MI.boss)h.addList=1;h.success=function(a){MI.tip(_("发送成功"));e.publishSuccess(a,b)};e.btnValue&&(a.value=e.btnValue);a.onmouseover=function(){this.onclick=function(){e.checkSend(h)&&h.send()}};UI.EA(h._txt,"keyup",function(){e.changeSelectData(h)});return h},changeTab:function(a){var b=this;UI.each(b.tab,function(c,d){a==d?(UI.show(b.div[d]),c.className=c.className.replace(/on$/,"")+"on"):(UI.hide(b.div[d]),c.className=c.className.replace(/on$/,""));1==a?(UI.hide(b.myFriend),b.msgBox.countTxt()):UI.show(b.myFriend);0==a&&(clearTimeout(b.slideDelay),b.slideDelay=setTimeout(function(){b.slide||b.buildSlide()},250))});b.hideWbpmauto();b.currTab=a},bindTabEvent:function(){var a=this;a.tab=UI.GT(a._title,"li");UI.each(a.tab,function(b,c){b.onclick=function(b){c!=a.currTab&&(a.changeTab(c),MI.Bos("btnSpringTabClick"+c),UI.E(b).prevent())}})},checkSend:function(a){var b=(a._txt.value.match(this.atReg)||[]).length||0,c="",d=a._txt.value;a.countTxt();b?b>this.select.max?c=_("一次最多选{0}个好友",this.select.max):d||(c=_("写点祝福语吧！")):c=_("请先选择好友");c&&a.showTip(c,1);return!c},publishSuccess:function(a,b){this.publishBos&&MI.Bos(this.publishBos,b,a.info&&a.info.talk&&a.info.talk[0]&&a.info.talk[0].id)},changeGift:function(a){this.index=a;if(!this.giftConfig[a])return!1;this.giftName.innerHTML=this.giftConfig[a].name;var b="",c=this.sendWord.value;UI.each(this.giftConfig,function(a){c.hasString(a.word)&&(b=a.word)});b?this.sendWord.value=c.replace(b,this.giftConfig[a].word):UI.trim(c)||(this.sendWord.value=this.giftConfig[a].word);1!=this.eventId&&(this.talk.sourcePic=this.giftConfig[a].pic.replace(/\.png$/,".jpg"));this.talk.countTxt()},reset:function(a){var b=this;UI.each(b.talkArray,function(a,d){a&&(a._txt.value=b.wordingList[d],a.hasMedia()&&(a._txt.value="",a.hideMedia(),a.reset(),a.delPic(),a.delMusic()))});b.msgBox._txt.value="";b.msgBox.countTxt();b.select&&(b.select.resetAllData(),b.select.refreshDataEvent({}),b.sendTo.value=b.placeHolder);b.slide&&(b.changeGift(b.index),b.talk.countTxt());b._wrap||(b._wrap=UI.parents(b.body,"DWrap")[0],b._title=d(b._wrap,".DTitle")[0],b._close=d(b._wrap,".DClose")[0],b._close.onmouseover=function(){b.select&&b.select.hide();b.hideWbpmauto()});b.bindTabEvent();b.changeTab(UI.isUndefined(a)?0:a)},hideWbpmauto:function(){(wbpmauto=d(document.body,".wbpmauto")[0])&&UI.hide(wbpmauto)},show:function(a){var b=this;b.builded||b.build();MI.dialog.show({title:b.domTitle||'<div class="chrisTit"><strong>'+b.title+"</strong></div>",html:b.body,width:580,start:function(){b.reset(a)}})}};MI.sendGiftShow=function(a,b){MI.springFestivalGift=MI.springFestivalGift||new MI.SendGift({eventId:4,topic:[_("#我爱你#"),_("#树洞告白#")],btnValue:_("祝福"),title:[_("爱的礼物"),_("密语告白")],bodyClass:"valentineWrap",placeHolder:_("输入好友姓名，最多可添加5个好友"),friendTitle:_("情人节，不要忘记给好友也送上祝福哦"),publishBos:"btnBlessPublished",wordingList:["",""],giftConfig:[{name:_("爱心"),pic:"http://mat1.gtimg.com/www/mb/images/theme/chrisTip/xinxiangyin.png",word:_("我数遍漫天繁星，最明亮的是你的眼，我看遍世间芳华，最灿烂的是你的脸，我踏遍山野清涧，最甘醇的是你的心，我寻遍所有的宝藏，最珍贵的，是我们的爱。")},{name:_("玫瑰"),pic:"http://mat1.gtimg.com/www/mb/images/theme/chrisTip/meigui.png",word:_("我一直在寻找着，生命中那朵玫瑰，终于让我遇见你，值得用一生追随。")},{name:_("巧克力"),pic:"http://mat1.gtimg.com/www/mb/images/theme/chrisTip/qiaokeli.png",word:_("你是我的巧克力情人，我是你最甜蜜的缘分，只要轻轻咬下一口，便能体会那种丝般的柔情。")},{name:_("钻戒"),pic:"http://mat1.gtimg.com/www/mb/images/theme/chrisTip/zhuanshi.png",word:_("无名指上的钻戒像阳光，陪我渡过风和霜，对爱情我很平凡，只想做你的另一半。")},{name:_("汽车"),pic:"http://mat1.gtimg.com/www/mb/images/theme/chrisTip/che.png",word:_("如果这是末日来临前的最后一个情人节，趁我还年轻，可以毫无保留的为爱付出；趁我还无知，可以完完全全的奉献自己；趁我还天真，可以相信爱你是一辈子的事；请你爱我的青春，爱我的痴狂，爱我的执着，完成我“不程式的爱情”——Jeep指南者")}]});MI.springFestivalGift.show(b);MI.Bos("btnSendGiftShow")}})();/*  |xGv00|e3696ef018c9407de00e7e549b551b1a */